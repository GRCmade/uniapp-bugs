{"version":3,"sources":["uni_modules/uni-recycle-view/components/uni-recycle-view/uni-recycle-view.uvue","pages/API/nodes-info/nodes-info-child.uvue"],"sourcesContent":["<template>\n  <scroll-view class=\"uni-recycle-view-main\" v-bind=\"$attrs\" ref=\"scroll\" @scroll=\"onScroll\">\n    <view :style=\"{ height: placeholderHeight + 'px' }\">\n      <view :style=\"{ top: containerTop + 'px' }\">\n        <slot :items=\"items\"></slot>\n      </view>\n    </view>\n  </scroll-view>\n</template>\n\n<script>\n  /**\n   * 使用限制\n   * - 容器大小变动时未刷新缓存的子元素大小\n   * - 不支持设置初始滚动位置\n   * - list数据内每一项不可以是基础类型\n   * - item不支持设置margin，会导致计算位置不准确\n   */\n  /**\n   * recycle-view 虚拟长列表组件\n   * @description 用于超长列表的展示\n   * @property {any[]} list 列表所有数据\n   */\n  export default {\n    name: \"uni-recycle-view\",\n    props: {\n      list: {\n        type: Array as PropType<any[]>,\n        default: [] as any[]\n      }\n    },\n    watch: {\n      list: {\n        handler(list : any[]) {\n          this.cachedSize.forEach((_ : number, key : any) => {\n            if (!list.includes(key)) {\n              this.cachedSize.delete(key)\n            }\n          })\n        },\n        deep: true\n      },\n      defaultItemSize() {\n        this.rearrange(this.lastScrollTop)\n      }\n    },\n    data() {\n      return {\n        items: [] as any[],\n        containerTop: 0,\n        scrollElementHeight: 0,\n        placeholderHeight: 0,\n        offsetThreshold: [0, 0, 0, 0], // -5, -3, 3, 5 屏对应的offset\n        cachedSize: new Map<any, number>(),\n        initialized: false,\n        hasDefaultSize: false,\n        defaultItemSize: 40,\n        lastScrollTop: 0,\n        rearrangeQueue: [] as number[]\n      };\n    },\n    provide() {\n      return {\n        setCachedSize: (item : any, size : number) => {\n          if (!this.hasDefaultSize) {\n            this.defaultItemSize = size\n            this.hasDefaultSize = true\n          }\n          this.cachedSize.set(item, size)\n        }\n      }\n    },\n    created() {\n      this.placeholderHeight = this.list.length * this.defaultItemSize\n    },\n    mounted() {\n      nextTick(() => {\n        uni.createSelectorQuery().in(this).select('.uni-recycle-view-main').boundingClientRect().exec((ret) => {\n          this.scrollElementHeight = (ret[0] as NodeInfo).height!\n          this.rearrange(0)\n          this.initialized = true\n        })\n      })\n    },\n    methods: {\n      onScroll(e : UniScrollEvent) {\n        if (!this.initialized) {\n          return\n        }\n        const scrollTop = e.detail.scrollTop\n        if (scrollTop === this.lastScrollTop || scrollTop < 0) {\n          return\n        }\n        this.lastScrollTop = scrollTop\n        if (scrollTop < this.offsetThreshold[1] || scrollTop > this.offsetThreshold[2]) {\n          this.queue(scrollTop)\n        }\n      },\n      queue(scrollTop : number) {\n        /*\n         * rearrange内为大量同步逻辑，在上次rearrange未执行完毕的情况下将后续多个rearrange合并成一次执行，即仅执行最后一次\n         * 由于滚动机制差异，此优化仅在web端才有意义。\n         * 如何测试：push后console.log(this.rearrangeQueue.length) 输出结果大于1时触发优化\n         */\n        this.rearrangeQueue.push(scrollTop)\n        setTimeout(() => {\n          this.flush()\n        }, 1)\n      },\n      flush() {\n        const queueLength = this.rearrangeQueue.length\n        if (queueLength == 0) {\n          return\n        }\n        const lastScrollTop = this.rearrangeQueue[queueLength - 1]\n        this.rearrange(lastScrollTop)\n        this.rearrangeQueue = [] as number[]\n      },\n      rearrange(scrollTop : number) {\n        this.offsetThreshold[0] = Math.max(scrollTop - this.scrollElementHeight * 5, 0)\n        this.offsetThreshold[1] = Math.max(scrollTop - this.scrollElementHeight * 3, 0)\n        this.offsetThreshold[2] = Math.min(scrollTop + this.scrollElementHeight * 4, this.placeholderHeight)\n        this.offsetThreshold[3] = Math.min(scrollTop + this.scrollElementHeight * 6, this.placeholderHeight)\n        const offsetStart = this.offsetThreshold[0]\n        const offsetEnd = this.offsetThreshold[3]\n        const items = [] as any[]\n        const defaultItemSize = this.defaultItemSize\n        const cachedSize = this.cachedSize\n        const list = this.list\n        let tempTotalHeight = 0\n        let containerTop = 0\n        let start = false, end = false\n        for (let i = 0; i < list.length; i++) {\n          const item = list[i]\n          let itemSize = defaultItemSize\n          const cachedItemSize = cachedSize.get(item)\n          if (cachedItemSize != null) {\n            itemSize = cachedItemSize\n          }\n          tempTotalHeight += itemSize\n          if (end) {\n            continue\n          }\n          if (tempTotalHeight < offsetStart) {\n            containerTop = tempTotalHeight\n          } else if (tempTotalHeight >= offsetStart && tempTotalHeight <= offsetEnd) {\n            if (start == false) {\n              start = true\n            }\n            items.push(item)\n          } else {\n            if (!end) {\n              end = true\n            }\n          }\n        }\n        this.placeholderHeight = tempTotalHeight\n        this.items = items\n        this.containerTop = containerTop\n      }\n    }\n  }\n</script>\n\n<style>\n\n</style>\n",null],"names":[],"mappings":"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"}