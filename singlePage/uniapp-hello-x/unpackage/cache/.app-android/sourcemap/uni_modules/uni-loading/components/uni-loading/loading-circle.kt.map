{"version":3,"sources":["uni_modules/uni-loading/components/uni-loading/loading-circle.uvue"],"sourcesContent":["<template>\n\n  <view :ref=\"elId\" class=\"block\" :style=\"{width:size+'px',height:size+'px'}\"></view>\n\n\n\n\n\n\n</template>\n<script>\n  import { easeInOutCubic } from './util'\n  let elId = 0\n  export default {\n    name: \"circle\",\n    props: {\n      speed: {\n        type: Number,\n        default: 16,\n      },\n      size: {\n        type: Number,\n        default: 20,\n      },\n      color: {\n        type: String,\n        default: '#666',\n      }\n    },\n    data() {\n      // 防止多调用，随机元素id\n      elId += 1\n      const elID = `Uni_Load_Circle_${elId}`\n      return {\n        elId: elID,\n        timer: 0,\n      };\n    },\n    computed: {\n      iconsSize() : number {\n        return (this.size / 10) +1\n      }\n    },\n    mounted() {\n\n      this.init()\n\n    },\n    unmounted() {\n      // 组件卸载时，需要卸载定时器，优化性能，防止页面卡死\n      clearInterval(this.timer)\n    },\n    methods: {\n      /**\n       * 初始化圆环\n       */\n      init() {\n        const refs = this.$refs[this.elId] as UniElement\n        let ctx = refs.getDrawableContext()!\n        this.build_circular(ctx)\n      },\n\n      /**\n       * 构建圆环动画\n       */\n      build_circular(ctx : DrawableContext) {\n        let startAngle = 0;\n        let rotate = 0;\n        const ARC_LENGTH = 359;\n        const center = this.size / 2; // 圆心\n        const lineWidth = this.size / 10; // 圆环宽度\n        const duration = 1200; // 动画持续时间\n        const interval = this.speed; // 定时器间隔（大约 60 帧每秒）\n\n        // 使圆环过度更自然，不必运动到底\n        const ARC_MAX = 358\n        let startTime = 0;\n        let foreward_end = 0 // 正传\n        let reversal_end = ARC_MAX // 反转\n        function pogress_time() : number {\n          const currentTime = Date.now();\n          // 运动时间计算\n          const elapsedTime = currentTime - startTime;\n          const progress = elapsedTime / duration;\n          // 动画缓动\n          const easedProgress = easeInOutCubic(progress);\n          return easedProgress\n        }\n        const draw = () => {\n\n          ctx.reset();\n          ctx.beginPath();\n\n          if (reversal_end == ARC_MAX) {\n            foreward_end = Math.min(pogress_time() * ARC_LENGTH, ARC_LENGTH); // 限制 end 的最大值为 ARC_LENGTH\n            if (foreward_end >= ARC_MAX) {\n              reversal_end = 0\n              foreward_end = ARC_MAX\n              startTime = Date.now();\n            }\n          }\n\n          if (foreward_end == ARC_MAX) {\n            reversal_end = Math.min(pogress_time() * ARC_LENGTH, ARC_LENGTH);\n            if (reversal_end >= ARC_MAX) {\n              reversal_end = ARC_MAX\n              foreward_end = 0\n              startTime = Date.now();\n            }\n          }\n\n          ctx.arc(\n            center,\n            center,\n            center - lineWidth,\n            startAngle + rotate + (reversal_end * Math.PI / 180),\n            startAngle + rotate + (foreward_end * Math.PI / 180)\n          );\n          ctx.lineWidth = lineWidth;\n          const fillColor = (this.color !== '' ? this.color : '#666').toString();\n          ctx.strokeStyle = fillColor;\n          ctx.stroke();\n          ctx.update();\n          rotate += 0.05; // 旋转速度\n        }\n\n        this.timer = setInterval(() => draw(), interval);\n      }\n\n    }\n  }\n</script>\n\n<style scoped>\n  .block {\n    width: 50px;\n    height: 50px;\n  }\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n</style>\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;AAaO;;kBA8BH,MAAU;YAER,IAAI,CAAC,IAAI;QAEX;;oBACA,MAAY;YAEV,cAAc,IAAI,CAAC,KAAK;QAC1B;;;;;;;eAjDF,mBAAmF,QAAA,SAA5E,SAAK,KAAA,IAAI,EAAE,WAAM,SAAS,WAAK,eAAE,SAAA,YAAA,KAAA,IAAA,GAAA,OAAA,aAAA,KAAA,IAAA,GAAA;;;;;aAgClC;aACA;wBAIY,MAAK;;;+BARX,CAAA;QACR,IAAM,OAAO,AAAC;wBAEZ,UAAM,MACN,WAAO,CAAC,0BAII,MAAK,EAAnB,OAAc,MAAK,CAAE;YACnB,OAAO,CAAC,IAAI,CAAC,IAAG,GAAI,EAAE,IAAG,CAAA;QAC3B;;;;aAeA,OAAA,MAAO;YACL,IAAM,OAAO,IAAI,CAAC,OAAK,CAAC,IAAI,CAAC,IAAI,CAAA,CAAE,EAAC,CAAE;YACtC,IAAI,MAAM,KAAK,kBAAkB;YACjC,IAAI,CAAC,cAAc,CAAC;QACtB;;aAKA,iBAAA,IAAe,KAAM,eAAe,EAAE;YACpC,IAAI,qBAAa,CAAC;YAClB,IAAI,iBAAS,CAAC;YACd,IAAM,qBAAa,GAAG;YACtB,IAAM,SAAS,IAAI,CAAC,IAAG,GAAI,CAAC;YAC5B,IAAM,YAAY,IAAI,CAAC,IAAG,GAAI,EAAE;YAChC,IAAM,mBAAW,IAAI;YACrB,IAAM,WAAW,IAAI,CAAC,KAAK;YAG3B,IAAM,kBAAU,GAAE;YAClB,IAAI,oBAAY,CAAC;YACjB,IAAI,uBAAe,CAAA;YACnB,IAAI,eAAe;YACnB,IAAS,gBAAiB,MAAK,CAAE;gBAC/B,IAAM,cAAc,KAAK,GAAG;gBAE5B,IAAM,cAAc,cAAc;gBAClC,IAAM,WAAW,cAAc;gBAE/B,IAAM,gBAAgB,eAAe;gBACrC,OAAO;YACT;YACA,IAAM,OAAO,KAAM;gBAEjB,IAAI,KAAK;gBACT,IAAI,SAAS;gBAEb,IAAI,gBAAgB,SAAS;oBAC3B,eAAe,KAAK,GAAG,CAAC,iBAAiB,YAAY;oBACrD,IAAI,gBAAgB,SAAS;wBAC3B,eAAe,CAAA;wBACf,eAAe;wBACf,YAAY,KAAK,GAAG;oBACtB;gBACF;gBAEA,IAAI,gBAAgB,SAAS;oBAC3B,eAAe,KAAK,GAAG,CAAC,iBAAiB,YAAY;oBACrD,IAAI,gBAAgB,SAAS;wBAC3B,eAAe;wBACf,eAAe,CAAA;wBACf,YAAY,KAAK,GAAG;oBACtB;gBACF;gBAEA,IAAI,GAAG,CACL,QACA,QACA,SAAS,WACT,aAAa,SAAS,CAAC,eAAe,KAAK,EAAC,GAAI,GAAG,GACnD,aAAa,SAAS,CAAC,eAAe,KAAK,EAAC,GAAI,GAAG;gBAErD,IAAI,SAAQ,GAAI;gBAChB,IAAM,YAAY,AAAC,CAAA,IAAA,IAAI,CAAC,KAAI,KAAM;oBAAK,IAAI,CAAC,KAAI;;oBAAI;;gBAAK,EAAG,QAAQ;gBACpE,IAAI,WAAU,GAAI;gBAClB,IAAI,MAAM;gBACV,IAAI,MAAM;gBACV,UAAU,IAAI;YAChB;;YAEA,IAAI,CAAC,KAAI,GAAI,YAAY;uBAAM;;cAAQ;QACzC;;;sBAvEA;sBASA,iBAAe,KAAM;;mBAnDjB;;;;;;;;;;;;;;wGAIO,EAAE,uDAIF,EAAE,wDAIF;;;;;;;;AAwGf"}