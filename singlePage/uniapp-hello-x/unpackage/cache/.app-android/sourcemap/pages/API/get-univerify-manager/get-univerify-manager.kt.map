{"version":3,"sources":["pages/API/get-univerify-manager/get-univerify-manager.uvue","pages/API/get-univerify-manager/get-univerify-manager.uvue?type=page","uni_modules/uni-upgrade-center-app/components/uni-upgrade-center-app/uni-upgrade-center-app.uvue","App.uvue"],"sourcesContent":["<template>\n  <view>\n    <page-head :title=\"title\"></page-head>\n    <view class=\"uni-padding-wrap uni-common-mt\">\n      <view class=\"uni-btn-v uni-common-mt\">\n        <button type=\"primary\" @click=\"verify(false)\">一键登录（半屏）</button>\n      </view>\n      <view class=\"uni-btn-v uni-common-mt\">\n        <button type=\"primary\" @click=\"verify(true)\">一键登录（全屏）</button>\n      </view>\n    </view>\n  </view>\n</template>\n\n<script>\n  export default {\n    data() {\n      return {\n        title: '一键登录',\n        univerifyManager: null as UniverifyManager | null\n      }\n    },\n    onLoad() {\n      this.univerifyManager = uni.getUniverifyManager();\n      // 预登录\n      this.univerifyManager?.preLogin({\n        success: () => {\n          console.log(\"pre login success\");\n        },\n        fail: (err : PreLoginFail) => {\n          console.error(\"pre login fail => \" + JSON.stringify(err));\n          uni.showToast({\n            title: '预登录失败'\n          });\n        }\n      } as PreLoginOptions);\n    },\n    methods: {\n      verify(fullScreen : boolean) {\n        // 校验预登录是否有效\n        const isPreLoginValid = this.univerifyManager?.isPreLoginValid() ?? false;\n        if (isPreLoginValid) {\n          // 预登录有效，执行登录\n          this.login(fullScreen);\n        } else {\n          // 预登录无效，执行预登录\n          this.univerifyManager?.preLogin({\n            success: () => {\n              console.log(\"pre login success\");\n              this.login(fullScreen);\n            },\n            fail: (err : PreLoginFail) => {\n              console.error(\"pre login fail => \" + JSON.stringify(err));\n              uni.showToast({\n                title: '预登录失败'\n              });\n            }\n          } as PreLoginOptions);\n        }\n      },\n      login(fullScreen : boolean) {\n        this.univerifyManager?.login({\n          // 登录页样式\n          univerifyStyle: {\n            fullScreen: fullScreen,\n            backgroundColor: \"#FFFFFF\",\n            loginBtnText: \"一键登录\",\n            logoPath: \"/static/logo.png\"\n          } as UniverifyStyle,\n          success: (res : LoginSuccess) => {\n            console.log(\"login success => \" + JSON.stringify(res));\n            // 云函数取号\n            uniCloud.callFunction({\n              name: 'univerify',\n              data: {\n                access_token: res.accessToken, // 客户端一键登录接口返回的access_token\n                openid: res.openId // 客户端一键登录接口返回的openid\n              }\n            }).then(res => {\n              // 关闭登录页\n              this.univerifyManager?.close();\n              setTimeout(() => {\n                uni.showModal({\n                  title: '取号成功',\n                  content: res.result.getJSON(\"res\")?.getString(\"phoneNumber\"),\n                  showCancel: false\n                });\n              }, 100);\n            }).catch(err => {\n              console.error(JSON.stringify(err));\n              // 关闭登录页\n              this.univerifyManager?.close();\n              setTimeout(() => {\n                uni.showModal({\n                  title: '取号失败',\n                  content: (err as Error).message,\n                  showCancel: false\n                });\n              }, 100);\n            });\n          },\n          fail: (err : LoginFail) => {\n            console.error(\"login fail => \" + err);\n            uni.showToast({\n              title: '登录失败'\n            });\n          }\n        } as LoginOptions);\n      }\n    }\n  }\n</script>\n\n<style>\n\n</style>\n",null,null,null],"names":[],"mappings":";;;;;;;;;;;;;;;;;+BAuBkC;;+BA+CtB;AAvDL;;eAOH,sBAAS;YACP,IAAI,CAAC,gBAAe,GAAI;YAExB,IAAI,CAAC,gBAAgB,EAAE,yBACrB,UAAS,KAAM;gBACb,QAAQ,GAAG,CAAC,qBAAoB;YAClC;cACA,OAAM,IAAC,KAAM,aAAiB;gBAC5B,QAAQ,KAAK,CAAC,uBAAuB,KAAK,SAAS,CAAC,MAAK;gBACzD,+BACE,QAAO;YAEX;;QAEJ;;;;;;;;eAnCF,mBAUO,QAAA,IAAA,EAAA;YATL,YAAsC,sBAAA,SAA1B,WAAO,KAAA,KAAK,GAAA,IAAA,EAAA,CAAA,EAAA;gBAAA;aAAA;YACxB,mBAOO,QAAA,SAPD,WAAM,mCAAgC;gBAC1C,mBAEO,QAAA,SAFD,WAAM,4BAAyB;oBACnC,mBAA+D,UAAA,SAAvD,UAAK,WAAW,aAAK,KAAA;wBAAE,KAAA,MAAM,CAAA,KAAA;oBAAA;uBAAS,YAAQ,CAAA,EAAA;wBAAA;qBAAA;;gBAExD,mBAEO,QAAA,SAFD,WAAM,4BAAyB;oBACnC,mBAA8D,UAAA,SAAtD,UAAK,WAAW,aAAK,KAAA;wBAAE,KAAA,MAAM,CAAA,IAAA;oBAAA;uBAAQ,YAAQ,CAAA,EAAA;wBAAA;qBAAA;;;;;aAUrD;aACA,kBAA0B;;;wBAD1B,WAAO,QACP,sBAAkB,IAAG,CAAE,EAAC,CAAE;;;aAmB5B,SAAA,IAAO,YAAa,OAAO,EAAE;YAE3B,IAAM,kBAAkB,IAAI,CAAC,gBAAgB,EAAE,qBAAqB,KAAK;YACzE,IAAI,iBAAiB;gBAEnB,IAAI,CAAC,KAAK,CAAC;YACb,OAAO;gBAEL,IAAI,CAAC,gBAAgB,EAAE,yBACrB,UAAS,KAAM;oBACb,QAAQ,GAAG,CAAC,qBAAoB;oBAChC,IAAI,CAAC,KAAK,CAAC;gBACb;kBACA,OAAM,IAAC,KAAM,aAAiB;oBAC5B,QAAQ,KAAK,CAAC,uBAAuB,KAAK,SAAS,CAAC,MAAK;oBACzD,+BACE,QAAO;gBAEX;;YAEJ;QACF;;aACA,QAAA,IAAM,YAAa,OAAO,EAAE;YAC1B,IAAI,CAAC,gBAAgB,EAAE,mBAErB,gCACE,aAAY,YACZ,kBAAiB,WACjB,eAAc,QACd,WAAU,qBAEZ,UAAS,IAAC,KAAM,aAAiB;gBAC/B,QAAQ,GAAG,CAAC,sBAAsB,KAAK,SAAS,CAAC,MAAK;gBAEtD,SAAS,YAAY,6BACnB,OAAM,aACN,OAAM;oBACJ,IAAA,eAAc,IAAI,WAAW;oBAC7B,IAAA,SAAQ,IAAI,MAAK;iBACnB,GACC,IAAI,CAAC,IAAA,IAAO;oBAEb,IAAI,CAAC,gBAAgB,EAAE;oBACvB,WAAW,KAAM;wBACf,+BACE,QAAO,QACP,UAAS,IAAI,MAAM,CAAC,OAAO,CAAC,QAAQ,UAAU,gBAC9C,aAAY,KAAI;oBAEpB;sBAAG,GAAG;gBACR;kBAAG,OAAK,CAAC,IAAA,IAAO;oBACd,QAAQ,KAAK,CAAC,KAAK,SAAS,CAAC,MAAK;oBAElC,IAAI,CAAC,gBAAgB,EAAE;oBACvB,WAAW,KAAM;wBACf,+BACE,QAAO,QACP,UAAS,CAAC,IAAI,EAAC,CAAE,QAAK,EAAE,OAAO,EAC/B,aAAY,KAAI;oBAEpB;sBAAG,GAAG;gBACR;;YACF;cACA,OAAM,IAAC,KAAM,UAAc;gBACzB,QAAQ,KAAK,CAAC,mBAAmB,KAAI;gBACrC,+BACE,QAAO;YAEX;;QAEJ;;;sBAtEA,SAAO,YAAa,OAAO;sBAsB3B,QAAM,YAAa,OAAO;;;;;;;;;;;;;;;AAkD9B"}