{"version":3,"sources":["pages/API/request-payment/request-payment.uvue","pages/API/get-app-base-info/get-app-base-info.uvue?type=page","pages/API/request-payment/request-payment.uvue?type=page","node-modules/@dcloudio/uni-components/lib-x/unicloud-db/unicloud-db.vue","pages/API/request/request.uvue?type=page","App.uvue"],"sourcesContent":["<template>\n\t<page-head title=\"发起支付\"></page-head>\n\n\t<template v-if=\"providerList.length > 0\">\n\t\t<button style=\"margin-top: 20px;\" type=\"primary\" v-for=\"(item,index) in providerList\" :key=\"index\"\n\t\t\t@click=\"requestPayment(item)\">{{item.name}}支付</button>\n\t</template>\n</template>\n\n<script>\n\texport type PayItem = { id : string, name : string, provider ?: UniProvider }\n\texport default {\n\t\tdata() {\n\t\t\treturn {\n\t\t\t\tbtnText: \"支付宝支付\",\n\t\t\t\tbtnType: \"primary\",\n\t\t\t\torderInfo: \"\",\n\t\t\t\terrorCode: 0,\n\t\t\t\terrorMsg: \"\",\n\t\t\t\tcomplete: false,\n\t\t\t\tproviderList: [] as PayItem[]\n\t\t\t}\n\t\t},\n\t\tonLoad: function () {\n\t\t\tuni.getProvider({\n\t\t\t\tservice: \"payment\",\n\t\t\t\tsuccess: (e) => {\n\t\t\t\t\tconsole.log(\"payment success:\" + JSON.stringify(e));\n\t\t\t\t\tlet array = e.provider as string[]\n\t\t\t\t\tarray.forEach((value : string) => {\n\t\t\t\t\t\tswitch (value) {\n\t\t\t\t\t\t\tcase 'alipay':\n\t\t\t\t\t\t\t\tthis.providerList.push({\n\t\t\t\t\t\t\t\t\tname: '支付宝',\n\t\t\t\t\t\t\t\t\tid: \"alipay\",\n\t\t\t\t\t\t\t\t\tprovider: e.providers.find((item) : boolean => {\n\t\t\t\t\t\t\t\t\t\treturn item.id == 'alipay'\n\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t} as PayItem);\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tcase 'wxpay':\n\t\t\t\t\t\t\t\tthis.providerList.push({\n\t\t\t\t\t\t\t\t\tname: '微信',\n\t\t\t\t\t\t\t\t\tid: \"wxpay\",\n\t\t\t\t\t\t\t\t\tprovider: e.providers.find((item) : boolean => {\n\t\t\t\t\t\t\t\t\t\treturn item.id == 'wxpay'\n\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t} as PayItem);\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t},\n\t\t\t\tfail: (e) => {\n\t\t\t\t\tconsole.log(\"获取支付通道失败：\", e);\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\tmethods: {\n\t\t\trequestPayment(e : PayItem) {\n\t\t\t\tconst provider = e.id\n\t\t\t\tif (provider == \"alipay\") {\n\t\t\t\t\tthis.payAli()\n\t\t\t\t} else if (provider == \"wxpay\") {\n\n\t\t\t\t\tif (e.provider != null && e.provider?.isAppExist==false) {\n\t\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\t\ttitle: \"微信没有安装\",\n\t\t\t\t\t\t\ticon:'error'\n\t\t\t\t\t\t})\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.payWX()\n\t\t\t\t\t}\n\n\t\t\t\t}\n\t\t\t},\n\t\t\tpayAli() {\n\t\t\t\tuni.showLoading({\n\t\t\t\t\ttitle: \"请求中...\"\n\t\t\t\t})\n\t\t\t\tuni.request({\n\t\t\t\t\turl: 'https://demo.dcloud.net.cn/payment/alipay/?total=0.01',\n\t\t\t\t\tmethod: 'GET',\n\t\t\t\t\ttimeout: 6000,\n\t\t\t\t\tsuccess: (res) => {\n\t\t\t\t\t\tthis.orderInfo = JSON.stringify(res.data);\n\t\t\t\t\t\tconsole.log(\"====\" + this.orderInfo)\n\t\t\t\t\t\tuni.hideLoading()\n\t\t\t\t\t\tuni.requestPayment({\n\t\t\t\t\t\t\tprovider: \"alipay\",\n\t\t\t\t\t\t\torderInfo: res.data as string,\n\t\t\t\t\t\t\tfail: (res) => {\n\t\t\t\t\t\t\t\tconsole.log(JSON.stringify(res))\n\t\t\t\t\t\t\t\tthis.errorCode = res.errCode\n\t\t\t\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\t\t\t\ticon: 'error',\n\t\t\t\t\t\t\t\t\ttitle: 'errorCode:' + this.errorCode\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tsuccess: (res) => {\n\t\t\t\t\t\t\t\tconsole.log(JSON.stringify(res))\n\t\t\t\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\t\t\t\ticon: 'success',\n\t\t\t\t\t\t\t\t\ttitle: '支付成功'\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t},\n\t\t\t\t\tfail: (e) => {\n\t\t\t\t\t\tconsole.log(e)\n\t\t\t\t\t\tuni.hideLoading()\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t},\n\t\t\tpayWX() {\n\t\t\t\tuni.showLoading({\n\t\t\t\t\ttitle: \"请求中...\"\n\t\t\t\t})\n\t\t\t\tlet url = 'https://demo.dcloud.net.cn/payment/wxpayv3.__UNI__uniappx/?total=0.01'\n\t\t\t\tconst res = uni.getAppBaseInfo();\n\t\t\t\tlet packageName:string | null\n\n\n\t\t\t\tpackageName = res.packageName\n\n\n\n\n\n\n\t\t\t\tif (packageName == 'io.dcloud.hellouniappx') {//hello uniappx\n\t\t\t\t  url = 'https://demo.dcloud.net.cn/payment/wxpayv3.__UNI__HelloUniAppX/?total=0.01'\n\t\t\t\t}\n\t\t\t\tuni.request({\n\t\t\t\t\turl: url,\n\t\t\t\t\tmethod: 'GET',\n\t\t\t\t\ttimeout: 6000,\n\t\t\t\t\theader: {\n\t\t\t\t\t\t\"Content-Type\": \"application/json\"\n\t\t\t\t\t} as UTSJSONObject,\n\t\t\t\t\tsuccess: (res) => {\n\t\t\t\t\t\tconsole.log(res.data)\n\t\t\t\t\t\tuni.hideLoading()\n\t\t\t\t\t\tuni.requestPayment({\n\t\t\t\t\t\t\tprovider: \"wxpay\",\n\t\t\t\t\t\t\torderInfo: JSON.stringify(res.data),\n\t\t\t\t\t\t\tfail: (res) => {\n\t\t\t\t\t\t\t\tconsole.log(JSON.stringify(res))\n\t\t\t\t\t\t\t\tthis.errorCode = res.errCode\n\t\t\t\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\t\t\t\tduration: 5000,\n\t\t\t\t\t\t\t\t\ticon: 'error',\n\t\t\t\t\t\t\t\t\ttitle: 'errorCode:' + this.errorCode,\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tsuccess: (res) => {\n\t\t\t\t\t\t\t\tconsole.log(JSON.stringify(res))\n\t\t\t\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\t\t\t\tduration: 5000,\n\t\t\t\t\t\t\t\t\ticon: 'success',\n\t\t\t\t\t\t\t\t\ttitle: '支付成功'\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t},\n\t\t\t\t\tfail: (res) => {\n\t\t\t\t\t\tuni.hideLoading()\n\t\t\t\t\t\tconsole.log(res)\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t},\n\n\t\t\t//自动化测试使用\n\t\t\tjest_pay() {\n\t\t\t\tuni.requestPayment({\n\t\t\t\t\tprovider: \"alipay\",\n\t\t\t\t\torderInfo: this.orderInfo,\n\t\t\t\t\tfail: (res : RequestPaymentFail) => {\n\t\t\t\t\t\tthis.errorCode = res.errCode\n\t\t\t\t\t\tthis.complete = true\n\t\t\t\t\t},\n\t\t\t\t\tsuccess: (res : RequestPaymentSuccess) => {\n\t\t\t\t\t\tconsole.log(JSON.stringify(res))\n\t\t\t\t\t\tthis.complete = true\n\t\t\t\t\t}\n\t\t\t\t} as RequestPaymentOptions)\n\t\t\t}\n\t\t}\n\t}\n</script>\n\n<style>\n\n</style>\n",null,null,null,null,null],"names":[],"mappings":"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"}