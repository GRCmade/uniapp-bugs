{"version":3,"sources":["pages/API/compress-image/compress-image.uvue","pages/API/compress-image/compress-image.uvue?type=page","pages/API/upload-file/upload-file.uvue?type=page","pages/API/get-image-info/get-image-info.uvue?type=page","node-modules/@dcloudio/uni-components/lib-x/unicloud-db/unicloud-db.vue","uni_modules/uni-upgrade-center-app/components/uni-upgrade-center-app/uni-upgrade-center-app.uvue","App.uvue"],"sourcesContent":["<template>\n\n  <scroll-view style=\"flex:1\">\n\n    <page-head :title=\"title\"></page-head>\n    <view class=\"uni-padding-wrap\">\n      <view class=\"image-container\">\n        <image class=\"image\" :src=\"beforeCompressPath\" mode=\"aspectFit\"></image>\n        <image class=\"image\" :src=\"afterCompressPath\" mode=\"aspectFit\"></image>\n      </view>\n      <view class=\"uni-title\">\n        <text class=\"uni-subtitle-text\">压缩前图片信息</text>\n      </view>\n      <text>{{beforeCompressImageInfo}}</text>\n      <view class=\"uni-title\">\n        <text class=\"uni-subtitle-text\">压缩后图片信息</text>\n      </view>\n      <text>{{afterCompressImageInfo}}</text>\n      <view class=\"uni-btn-v\">\n        <button type=\"primary\" @click=\"chooseImage\">从相册中选取待压缩的图片</button>\n      </view>\n      <view class=\"uni-btn-v\">\n        <button type=\"primary\" @click=\"compressImage\">压缩图片</button>\n      </view>\n    </view>\n    <input-data defaultValue=\"80\" title=\"压缩质量，范围0～100，数值越小，质量越低，压缩率越高（仅对jpg有效）\" type=\"number\"\n      @confirm=\"onQualityConfirm\"></input-data>\n    <input-data title=\"压缩后图片的宽度，单位px\" type=\"string\" @confirm=\"onCompressedWidthConfirm\"></input-data>\n    <input-data title=\"压缩后图片的高度，单位px\" type=\"string\" @confirm=\"onCompressedHeightConfirm\"></input-data>\n    <input-data defaultValue=\"auto\" title=\"压缩后图片的宽度，支持px、%、auto\" type=\"string\" @confirm=\"onWidthConfirm\"></input-data>\n    <input-data defaultValue=\"auto\" title=\"压缩后图片的高度，支持px、%、auto\" type=\"string\" @confirm=\"onHeightConfirm\"></input-data>\n    <input-data defaultValue=\"0\" title=\"旋转度数，范围0～360\" type=\"number\" @confirm=\"onRotateConfirm\"></input-data>\n\n  </scroll-view>\n\n</template>\n\n<script>\n\n  import FileInputStream from 'java.io.FileInputStream';\n\n  export default {\n    data() {\n      return {\n        title: \"compressImage\",\n        beforeCompressImageInfo: \"\",\n        afterCompressImageInfo: \"\",\n        beforeCompressPath: \"\",\n        afterCompressPath: \"\",\n        quality: 80,\n        compressedWidth: null as number | null,\n        compressedHeight: null as number | null,\n        width: \"auto\",\n        height: \"auto\",\n        rotate: 0,\n        // 自动化测试\n        imageInfoForTest: null,\n        imageSrcForTest: '/static/test-image/logo.png'\n      }\n    },\n    methods: {\n      compressImage() {\n        if (this.beforeCompressPath == \"\") {\n          uni.showToast({\n            title: \"请先选择图片\",\n            icon: \"error\"\n          });\n          return;\n        }\n        uni.showLoading({\n          title: \"图片压缩中\"\n        });\n        uni.compressImage({\n          src: this.beforeCompressPath,\n          quality: this.quality,\n          compressedWidth: this.compressedWidth,\n          compressedHeight: this.compressedHeight,\n          width: this.width,\n          height: this.height,\n          rotate: this.rotate,\n          success: (res) => {\n            console.log(\"compressImage success\", JSON.stringify(res));\n            this.afterCompressPath = res.tempFilePath;\n            uni.showToast({\n              title: \"压缩成功\",\n              icon: null\n            });\n            uni.getImageInfo({\n              src: res.tempFilePath,\n              success: (_res) => {\n                this.afterCompressImageInfo = `图片宽度: ${_res.width}\\n图片高度: ${_res.height}\\n`;\n\n                const size = new FileInputStream(res.tempFilePath.substring(\"file://\".length)).available() / 1024;\n                this.afterCompressImageInfo = this.afterCompressImageInfo.concat(`图片大小: ${size}KB`);\n\n              }\n            });\n          },\n          fail: (err) => {\n            uni.showModal({\n              title: \"压缩图片失败\",\n              content: JSON.stringify(err),\n              showCancel: false\n            });\n          },\n          complete: (_) => {\n            uni.hideLoading();\n          }\n        });\n      },\n      chooseImage() {\n        uni.chooseImage({\n          count: 1,\n          sizeType: [\"original\"],\n          sourceType: [\"album\"],\n          success: (res) => {\n            this.beforeCompressPath = res.tempFilePaths[0];\n            uni.getImageInfo({\n              src: res.tempFilePaths[0],\n              success: (_res) => {\n                this.beforeCompressImageInfo = `图片宽度: ${_res.width}\\n图片高度: ${_res.height}\\n`;\n\n                const size = new FileInputStream(res.tempFilePaths[0].substring(\"file://\".length)).available() / 1024;\n                this.beforeCompressImageInfo = this.beforeCompressImageInfo.concat(`图片大小: ${size}KB`);\n\n              }\n            });\n          }\n        });\n      },\n      onQualityConfirm(value : number) {\n        this.quality = value;\n      },\n      onCompressedWidthConfirm(value : string) {\n        this.compressedWidth = parseInt(value);\n      },\n      onCompressedHeightConfirm(value : string) {\n        this.compressedHeight = parseInt(value);\n      },\n      onWidthConfirm(value : string) {\n        this.width = value;\n      },\n      onHeightConfirm(value : string) {\n        this.height = value;\n      },\n      onRotateConfirm(value : number) {\n        this.rotate = value;\n      },\n      testCompressImage() {\n        uni.compressImage({\n          src: this.imageSrcForTest,\n          quality: 50,\n          compressedWidth: 100,\n          compressedHeight: 100,\n          success: (res) => {\n            uni.getImageInfo({\n              src: res.tempFilePath,\n              success: (_res) => {\n                let beforeCompressSize: number, afterComoressSize: number;\n\n                beforeCompressSize = new FileInputStream(UTSAndroid.convert2AbsFullPath(this.imageSrcForTest)).available();\n                afterComoressSize = new FileInputStream(res.tempFilePath.substring(\"file://\".length)).available();\n\n                this.imageInfoForTest = {\n                  \"width\": _res.width,\n                  \"height\": _res.height,\n                  \"isSizeReduce\": afterComoressSize < beforeCompressSize\n                };\n              }\n            });\n          },\n          fail: (_) => {\n            this.imageInfoForTest = null;\n          }\n        });\n      }\n    }\n  }\n</script>\n\n<style>\n  .image {\n    flex: 1;\n  }\n\n  .image-container {\n    flex-direction: row;\n  }\n</style>\n",null,null,null,null,null,null],"names":[],"mappings":"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"}