{"version":3,"sources":["pages/API/websocket-global/websocket-global.uvue","pages/API/websocket-global/websocket-global.uvue?type=page","pages/API/websocket-socketTask/websocket-socketTask.uvue?type=page","uni_modules/uni-upgrade-center-app/utils/call-check-version.ts","node-modules/@dcloudio/uni-components/lib-x/unicloud-db/unicloud-db.vue","uni_modules/uni-upgrade-center-app/components/uni-upgrade-center-app/uni-upgrade-center-app.uvue","App.uvue"],"sourcesContent":["<template>\r\n  <page-head title=\"websocket通讯示例\"></page-head>\r\n  <view class=\"uni-padding-wrap\">\r\n    <view class=\"uni-btn-v\">\r\n      <text class=\"websocket-msg\">{{ showMsg }}</text>\r\n      <button class=\"uni-btn-v\" type=\"primary\" @click=\"connect\">\r\n        连接websocket服务\r\n      </button>\r\n      <button class=\"uni-btn-v\" v-show=\"connected\" type=\"primary\" @click=\"send\">\r\n        发送一条消息\r\n      </button>\r\n      <button class=\"uni-btn-v\" type=\"primary\" @click=\"close\">\r\n        断开websocket服务\r\n      </button>\r\n      <text class=\"websocket-tips\">发送消息后会收到一条服务器返回的消息（与发送的消息内容一致）</text>\r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<script>\r\n  export default {\r\n    data() {\r\n      return {\r\n        connected: false,\r\n        connecting: false,\r\n        msg: '',\r\n        roomId: '',\r\n        platform: '',\r\n      }\r\n    },\r\n    computed: {\r\n      showMsg() : string {\r\n        if (this.connected) {\r\n          if (this.msg.length > 0) {\r\n            return '收到消息：' + this.msg\r\n          } else {\r\n            return '等待接收消息'\r\n          }\r\n        } else {\r\n          return '尚未连接'\r\n        }\r\n      },\r\n    },\r\n    onLoad() {\r\n      this.platform = uni.getSystemInfoSync().platform\r\n    },\r\n    onUnload() {\r\n      uni.closeSocket({\r\n        code: 1000,\r\n        reason: 'close reason from client',\r\n        success: (res : any) => {\r\n          console.log('uni.closeSocket success', res)\r\n        },\r\n        fail: (err : any) => {\r\n          console.log('uni.closeSocket fail', err)\r\n        },\r\n      } as CloseSocketOptions)\r\n      uni.hideLoading()\r\n    },\r\n    methods: {\r\n      connect() {\r\n        if (this.connected || this.connecting) {\r\n          uni.showModal({\r\n            content: '正在连接或者已经连接，请勿重复连接',\r\n            showCancel: false,\r\n          })\r\n          return\r\n        }\r\n        this.connecting = true\r\n        uni.showLoading({\r\n          title: '连接中...',\r\n        })\r\n        uni.connectSocket({\r\n          url: 'ws://websocket.dcloud.net.cn',\r\n          header: null,\r\n          protocols: null,\r\n          success: (res : any) => {\r\n            // 这里是接口调用成功的回调，不是连接成功的回调，请注意\r\n            console.log('uni.connectSocket success', res)\r\n          },\r\n          fail: (err : any) => {\r\n            // 这里是接口调用失败的回调，不是连接失败的回调，请注意\r\n            console.log('uni.connectSocket fail', err)\r\n          },\r\n        })\r\n        uni.onSocketOpen((res) => {\r\n          this.connecting = false\r\n          this.connected = true\r\n          uni.hideLoading()\r\n\r\n          uni.showToast({\r\n            icon: 'none',\r\n            title: '连接成功',\r\n          })\r\n          console.log('onOpen', res)\r\n        })\r\n        uni.onSocketError((err) => {\r\n          this.connecting = false\r\n          this.connected = false\r\n          uni.hideLoading()\r\n\r\n          uni.showModal({\r\n            content: '连接失败，可能是websocket服务不可用，请稍后再试',\r\n            showCancel: false,\r\n          })\r\n          console.log('onError', err)\r\n        })\r\n        uni.onSocketMessage((res) => {\r\n          this.msg = res.data as string\r\n          console.log('onMessage', res)\r\n        })\r\n        uni.onSocketClose((res) => {\r\n          this.connected = false\r\n          this.msg = ''\r\n          console.log('onClose', res)\r\n        })\r\n      },\r\n      send() {\r\n        uni.sendSocketMessage({\r\n          data:\r\n            'from ' +\r\n            this.platform +\r\n            ' : ' +\r\n            parseInt((Math.random() * 10000).toString()).toString(),\r\n          success: (res : any) => {\r\n            console.log(res)\r\n          },\r\n          fail: (err : any) => {\r\n            console.log(err)\r\n          },\r\n        } as SendSocketMessageOptions)\r\n      },\r\n      close() {\r\n        uni.closeSocket({\r\n          code: 1000,\r\n          reason: 'close reason from client',\r\n          success: (res : any) => {\r\n            console.log('uni.closeSocket success', res)\r\n          },\r\n          fail: (err : any) => {\r\n            console.log('uni.closeSocket fail', err)\r\n          },\r\n        } as CloseSocketOptions)\r\n      },\r\n    },\r\n  }\r\n</script>\r\n\r\n<style>\r\n  .uni-btn-v {\r\n    padding: 5px 0;\r\n  }\r\n\r\n  .uni-btn-v {\r\n    margin: 10px 0;\r\n  }\r\n\r\n  .websocket-msg {\r\n    padding: 40px 0px;\r\n    text-align: center;\r\n    font-size: 14px;\r\n    line-height: 40px;\r\n    color: #666666;\r\n  }\r\n\r\n  .websocket-tips {\r\n    padding: 40px 0px;\r\n    text-align: center;\r\n    font-size: 14px;\r\n    line-height: 24px;\r\n    color: #666666;\r\n  }\r\n</style>\n",null,null,null,null,null,null],"names":[],"mappings":"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"}