{"version":3,"sources":["pages/API/create-request-permission-listener/create-request-permission-listener.uvue","pages/API/create-request-permission-listener/create-request-permission-listener.uvue?type=page","App.uvue"],"sourcesContent":["<template>\n\n  <scroll-view style=\"flex:1\">\n\n    <page-head title=\"权限申请监听\"></page-head>\n    <view class=\"permission-alert\" id=\"permission-alert\" :style=\"{'transform':isPermissionAlertShow ? 'translateY(0)':'translateY(-110px)'}\">\n      <text style=\"font-size: 20px;margin-bottom: 10px;margin-top: 5px;\">访问日历权限申请说明：</text>\n      <text style=\"color: darkgray;\">uni-app x正在申请访问日历权限用于演示，允许或拒绝均不会获取任何隐私信息。</text>\n    </view>\n    <button type=\"primary\" style=\"margin: 10px;\" @click=\"requestPermission\">点击申请日历权限</button>\n\n\n  </scroll-view>\n\n</template>\n\n<script>\n  export default {\n    data() {\n      return {\n        isPermissionAlertShow: false,\n        permissionAlert: null as UniElement | null,\n        timeoutId: -1,\n        permissionListener: null as RequestPermissionListener | null\n      }\n    },\n\n    onReady() {\n      this.watchPermissionRRequest()\n    },\n    onUnload() {\n      this.permissionListener?.stop()\n      this.permissionListener = null\n      clearTimeout(this.timeoutId)\n    },\n    methods: {\n      watchPermissionRRequest() {\n        this.permissionListener = uni.createRequestPermissionListener()\n        this.permissionListener!.onConfirm((_) => {\n          // TODO 目前onConfirm监听实现的在时间上不够精确，暂时需要延迟弹框，后续修复\n          // TODO 这里的弹框仅为演示，实际开发中监听权限申请的代码应该在app.uvue中，弹框应全局处理，可参考https://gitcode.net/dcloud/uni-api/-/tree/master/uni_modules/uni-prompt/utssdk/app-android 代码自行封装一个uts的全局弹框\n          this.timeoutId = setTimeout(() => {\n            this.isPermissionAlertShow = true\n          }, 100)\n        })\n        this.permissionListener!.onComplete((_) => {\n          clearTimeout(this.timeoutId)\n          this.isPermissionAlertShow = false\n        })\n      },\n      requestPermission() {\n\n        if (UTSAndroid.checkSystemPermissionGranted(UTSAndroid.getUniActivity()!, [\"android.permission.READ_CALENDAR\"])) {\n          uni.showToast({\n            title: \"权限已经同意了，不需要再申请\",\n            position: \"bottom\"\n          })\n          return\n        }\n        UTSAndroid.requestSystemPermission(UTSAndroid.getUniActivity()!, [\"android.permission.READ_CALENDAR\"], (_ : boolean, p : string[]) => {\n          console.log(p)\n        }, (_ : boolean, p : string[]) => {\n          uni.showToast({\n            title: \"权限被拒绝了\",\n            position: \"bottom\"\n          })\n          console.log(p)\n        })\n\n      }\n    }\n  }\n</script>\n\n<style>\n  .permission-alert {\n    width: 90%;\n    height: 100px;\n    margin: 10px 5%;\n    position: absolute;\n    top: 0px;\n    z-index: 3;\n    border-radius: 5px;\n    transition-property: transform;\n    transition-duration: 200ms;\n    background-color: white;\n    padding: 10px;\n  }\n</style>\n",null,null],"names":[],"mappings":";;;;;;;;;;;;;;;;;+BAqCsC;;AApB/B;;gBAUH,MAAU;YACR,IAAI,CAAC,uBAAuB;QAC9B;;iBACA,MAAW;YACT,IAAI,CAAC,kBAAkB,EAAE;YACzB,IAAI,CAAC,kBAAiB,GAAI,IAAG;YAC7B,aAAa,IAAI,CAAC,SAAS;QAC7B;;;;;;;;eAhCF,mBAUc,eAAA,SAVD,WAAc,eAAd,SAAA,UAAA;YAEX,YAAsC,sBAAA,SAA3B,WAAM;YACjB,mBAGO,QAAA,SAHD,WAAM,oBAAmB,QAAG,oBAAoB,WAAK,eAAE,SAAA,eAAA,IAAA,KAAA,qBAAA;gBAAA;;gBAAA;;YAAA;gBAC3D,mBAAqF,QAAA,SAA/E,WAA4D,eAA5D,SAAA,eAAA,QAAA,mBAAA,QAAA,gBAAA,UAA6D,eAAW,CAAA;gBAC9E,mBAA+E,QAAA,SAAzE,WAAwB,eAAxB,SAAA,WAAA,eAAyB,6CAAyC,CAAA;;YAE1E,mBAAyF,UAAA,SAAjF,UAAK,WAAU,WAAqB,eAArB,SAAA,YAAA,UAAuB,aAAO,KAAA,iBAAiB,GAAE,YAAQ,EAAA,EAAA;gBAAA;aAAA;;;aAW5E;aACA,iBAAyB;aACzB;aACA,oBAA4B;;;wBAH5B,2BAAuB,KAAK,EAC5B,qBAAiB,IAAG,CAAE,EAAC,CAAE,aACzB,eAAW,CAAC,CAAC,EACb,wBAAoB,IAAG,CAAE,EAAC,CAAE;;;aAa9B,0BAAA,MAA0B;YACxB,IAAI,CAAC,kBAAiB,GAAI;YAC1B,IAAI,CAAC,kBAAkB,GAAE,SAAS,CAAC,IAAC,EAAM;gBAGxC,IAAI,CAAC,SAAQ,GAAI,WAAW,KAAM;oBAChC,IAAI,CAAC,qBAAoB,GAAI,IAAG;gBAClC;kBAAG,GAAG;YACR;;YACA,IAAI,CAAC,kBAAkB,GAAE,UAAU,CAAC,IAAC,EAAM;gBACzC,aAAa,IAAI,CAAC,SAAS;gBAC3B,IAAI,CAAC,qBAAoB,GAAI,KAAI;YACnC;;QACF;;aACA,oBAAA,MAAoB;YAElB,IAAI,WAAW,4BAA4B,CAAC,WAAW,cAAc,MAAK;gBAAC;aAAmC,GAAG;gBAC/G,+BACE,QAAO,kBACP,WAAU;gBAEZ;YACF;YACA,WAAW,uBAAuB,CAAC,WAAW,cAAc,MAAK;gBAAC;aAAmC,EAAE,IAAC,GAAI,OAAO,EAAE,YAAI,MAAM,EAAO;gBACpI,QAAQ,GAAG,CAAC,GAAC;YACf;cAAG,IAAC,GAAI,OAAO,EAAE,YAAI,MAAM,EAAO;gBAChC,+BACE,QAAO,UACP,WAAU;gBAEZ,QAAQ,GAAG,CAAC,GAAC;YACf;;QAEF;;;sBAjCA;sBAcA;;;;;;;;;;;;;;;;;;;;;AAqBJ"}