{"version":3,"sources":["pages/API/upload-file/upload-file.uvue","pages/API/upload-file/upload-file.uvue?type=page","uni_modules/uni-upgrade-center-app/components/uni-upgrade-center-app/uni-upgrade-center-app.uvue","pages/API/get-file-system-manager/get-file-system-manager.uvue?type=page","node-modules/@dcloudio/uni-components/lib-x/unicloud-db/unicloud-db.vue","pages/API/request/request.uvue?type=page","App.uvue"],"sourcesContent":["<template>\n\n  <scroll-view class=\"page-scroll-view\">\n\n    <view>\n      <page-head :title=\"title\"></page-head>\n      <view class=\"uni-padding-wrap uni-common-mt\">\n        <view class=\"demo\">\n          <image v-if=\"imageSrc\" :src=\"imageSrc\" class=\"image\" mode=\"widthFix\"></image>\n          <text v-else class=\"uni-hello-addfile\" @click=\"chooseImage\">+ 选择图片</text>\n        </view>\n      </view>\n    </view>\n\n  </scroll-view>\n\n</template>\n<script>\n\n  import {\n    testInovkeUploadFile,\n    CommonOptions\n  } from '@/uni_modules/test-invoke-network-api'\n\n\n  export default {\n    data() {\n      return {\n        title: 'uploadFile',\n        imageSrc: '',\n        task: null as UploadTask | null,\n        //自动化测试例专用\n        jest_result: false,\n      }\n    },\n    onLoad() {\n    },\n    onUnload() {\n      this.imageSrc = '';\n      uni.hideLoading();\n      this.task?.abort();\n    },\n    methods: {\n      chooseImage: function () {\n        uni.chooseImage({\n          count: 1,\n          sizeType: ['compressed'],\n          sourceType: ['album'],\n          success: (res) => {\n            console.log('chooseImage success, temp path is', res.tempFilePaths[0])\n            var imageSrc = res.tempFilePaths[0]\n            uni.showLoading({\n              title: '上传中'\n            })\n            this.task = uni.uploadFile({\n              url: 'https://unidemo.dcloud.net.cn/upload', //仅为示例，非真实的接口地址\n              filePath: imageSrc,\n              name: 'file',\n              formData: {\n                'user': 'test'\n              },\n              success: (res) => {\n                console.log('uploadImage success, res is:', res)\n                uni.hideLoading();\n                uni.showToast({\n                  title: '上传成功',\n                  icon: 'success',\n                  duration: 1000\n                })\n                this.imageSrc = imageSrc\n              },\n              fail: (err) => {\n                console.log('uploadImage fail', err);\n                uni.hideLoading();\n                uni.showModal({\n                  content: err.errMsg,\n                  showCancel: false\n                });\n              },\n            });\n          },\n          fail: (err) => {\n            console.log('chooseImage fail', err)\n          }\n        })\n      },\n      //自动化测试例专用\n      jest_uploadFile() {\n        const imageSrc = \"/static/uni.png\";\n        this.task = uni.uploadFile({\n          url: 'https://unidemo.dcloud.net.cn/upload', //仅为示例，非真实的接口地址\n          filePath: imageSrc,\n          name: 'file',\n          formData: {\n            'user': 'test'\n          },\n          success: () => {\n            this.jest_result = true;\n          },\n          fail: () => {\n            this.jest_result = false;\n          },\n        })\n      },\n      jest_uploadFile_with_uni_env() {\n        const filePath = `${uni.env.CACHE_PATH}/download/uni-app.png`\n        uni.downloadFile({\n          url: \"https://qiniu-web-assets.dcloud.net.cn/unidoc/zh/uni-app.png\",\n          filePath: filePath,\n          success: () => {\n            uni.uploadFile({\n              url: 'https://unidemo.dcloud.net.cn/upload', //仅为示例，非真实的接口地址\n              filePath: filePath,\n              name: 'file',\n              success: () => {\n                this.jest_result = true;\n              },\n              fail: () => {\n                this.jest_result = false;\n              },\n            })\n          },\n          fail: () => {\n            this.jest_result = false\n          }\n        });\n      },\n      jest_set_cookie() {\n        uni.request({\n          url: \"https://request.dcloud.net.cn/api/http/header/setCookie\",\n          method: \"GET\",\n          timeout: 6000,\n          sslVerify: false,\n          withCredentials: false,\n          firstIpv4: false,\n          success: () => {\n            this.jest_cookie_upload(true)\n          },\n          fail: () => {\n            this.jest_result = false;\n          },\n        });\n      },\n\n      jest_delete_cookie() {\n        uni.request({\n          url: \"https://request.dcloud.net.cn/api/http/header/deleteCookie\",\n          method: \"GET\",\n          timeout: 6000,\n          sslVerify: false,\n          withCredentials: false,\n          firstIpv4: false,\n          success: () => {\n            this.jest_cookie_upload(false)\n          },\n          fail: () => {\n            this.jest_result = false;\n          },\n        });\n      },\n      jest_cookie_upload(needCookie : boolean) {\n        const imageSrc = \"/static/uni.png\";\n        this.task = uni.uploadFile({\n          url: 'https://request.dcloud.net.cn/api/http/header/upload',\n          filePath: imageSrc,\n          name: 'file',\n          success: (res : UploadFileSuccess) => {\n            const data = JSON.parseObject(res.data)\n            const errCode = data?.getNumber(\"errCode\")\n            if (errCode != null && errCode == 1000) {\n              this.jest_result = needCookie ? false : true;\n            } else {\n              this.jest_result = needCookie ? true : false;\n            }\n          },\n          fail: () => {\n            this.jest_result = false;\n          },\n        })\n      },\n      jest_files_upload() {\n        const imageSrc = \"/static/uni.png\";\n        this.task = uni.uploadFile({\n          url: 'https://unidemo.dcloud.net.cn/upload',\n          files: [\n            {\n              name: \"file1\",\n              uri: imageSrc\n            } as UploadFileOptionFiles,\n            {\n              name: \"file2\",\n              uri: imageSrc\n            } as UploadFileOptionFiles\n          ],\n          success: (res : UploadFileSuccess) => {\n            if (res.statusCode == 200) {\n              this.jest_result = true;\n            }\n          },\n          fail: () => {\n            this.jest_result = false;\n          },\n        })\n      },\n      jest_uts_module_invoked() {\n\n        testInovkeUploadFile({\n          success: (res : any) => {\n            console.log(\"success :\", res);\n            this.jest_result = true\n          },\n          fail: (err : any) => {\n            console.log(\"fail :\", err);\n            this.jest_result = false\n          }\n        } as CommonOptions)\n\n      }\n    }\n  }\n</script>\n\n<style>\n  .image {\n    width: 100%;\n  }\n\n  .demo {\n    background: #fff;\n    padding: 25px;\n    justify-content: center;\n    align-items: center;\n  }\n\n  .uni-hello-addfile {\n    text-align: center;\n    background: #fff;\n    padding: 25px;\n    margin-top: 10px;\n    font-size: 19px;\n    color: #808080;\n  }\n</style>\n",null,null,null,null,null,null],"names":[],"mappings":"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"}