{"version":3,"sources":["pages/template/swiper-vertical-video/swiper-vertical-video.uvue","pages/component/video/video.uvue?type=page","uni_modules/uni-upgrade-center-app/utils/call-check-version.ts","uni_modules/uni-upgrade-center-app/components/uni-upgrade-center-app/uni-upgrade-center-app.uvue","pages/template/swiper-vertical-video/swiper-vertical-video.uvue?type=page"],"sourcesContent":["<template>\n  <view class=\"page\">\n    <view ref=\"back\" @click=\"back\" class=\"nav-back\">\n      <image class=\"back-img\" src=\"/static/template/scroll-fold-nav/back.png\" mode=\"widthFix\"></image>\n    </view>\n    <swiper class=\"swiper\" :current=\"current\" :circular=\"index != 0\" :vertical=\"true\" @change=\"onSwiperChange\"\n      @transition=\"onTransition\">\n      <swiper-item class=\"swiper-item\" v-for=\"(item,i) in visibleList\" :key=\"i\">\n        <video @click=\"changeState(i)\" ref=\"video\" class=\"video-box\" :id=\"'video-'+i\"\n          @loadstart=\"onLoadstart(i)\" :src=\"item.src\" :poster=\"item.poster_src\" :autoplay=\"false\"\n          :show-center-play-btn=\"false\" :loop=\"true\" @play=\"onPlay(i)\" @pause=\"onPause(i)\" http-cache=\"true\"></video>\n        <view class=\"video-cover\" @click=\"changeState(i)\">\n          <image v-if=\"state[i] === 'pause'\" class=\"play-btn\" src=\"/static/template/swiper-vertical-video/play.png\"\n            mode=\"widthFix\"></image>\n        </view>\n        <view class=\"video-info\" v-if=\"0\">\n          <text class=\"video-info-text\">容器：第 {{i}} 个</text>\n          <text class=\"video-info-text\">内容：{{item.content}}</text>\n        </view>\n      </swiper-item>\n    </swiper>\n    <view class=\"debug-info\" v-if=\"0\">\n      <text class=\"status-text\">debug-info 播放状态:</text>\n      <text class=\"status-text\" v-for=\"(value,index) in state\">第{{index+1}}个:{{ value }}</text>\n    </view>\n  </view>\n</template>\n<script>\n  type ListItem = { _id : string, content : string, src : string, poster_src : string }\n  let page : number = 0,\n    currentPageIsShow : boolean = true;\n\n  export default {\n    components: {},\n    data() {\n      return {\n        $videoContextMap: new Map<string, VideoContext>(),\n        list: [] as ListItem[],\n        visibleList: [] as ListItem[],// 提高性能 可见的只有3个\n        current: 0 as number,\n        index: 0,\n        state: [\"unPlay\", \"unPlay\", \"unPlay\"] as string[]\n      }\n    },\n    created() {\n      this.list = this.getData()\n      this.visibleList = this.list.slice(0, 3)\n    },\n    watch: {\n      current(current : number, oldCurrent : number) {\n        let changeNumber = current - oldCurrent\n        if (changeNumber == 1 || changeNumber == -2) {\n          // console.error('向右');\n          this.index++\n        } else {\n          // console.error('向左');\n          this.index--\n        }\n        // //翻页（3项为一页）\n        if (Math.abs(changeNumber) == 2) {\n          // console.log('翻页');\n          page = Math.floor(this.index / 3);\n          // console.log(this.index);\n          // console.log('page',page);\n          // console.log('slice',3*page,3*page+3);\n          if (this.list.length < 3 * page + 3) {\n            let list : ListItem[] = this.getData()\n            this.list.push(...list)\n          }\n\n          let visibleList = this.list.slice(3 * page, 3 * page + 3)\n          // 换数据\n          this.visibleList = visibleList\n        }\n\n        this.state.forEach((_ : string, index : number) => {\n          if (index === current) {\n            this.doPlay(current)\n          } else {\n            // 除了选中的其他已经播放的都需要停止\n            this.doStop(index)\n            console.log('index:' + index + '已被执行停止');\n          }\n        })\n      }\n    },\n    onReady() {\n      // 一启动完成，就播放第一个\n      this.doPlay(0);\n\n      //App端适配不同状态栏高度\n      let backElement = this.$refs['back'] as UniElement;\n      backElement.style.setProperty('top', uni.getSystemInfoSync().statusBarHeight+'px');\n\n    },\n    onShow() {\n      currentPageIsShow = true\n    },\n    onHide() {\n      currentPageIsShow = false\n      console.log('pages-onHide');\n      this.doPause(this.current)\n    },\n    onUnload() {\n      this.doPause(this.current)\n    },\n    methods: {\n      changeState(index : number) {\n        if (this.state[index] === 'play') {\n          this.doPause(index)\n        } else {\n          this.doPlay(this.current)\n        }\n      },\n      onLoadstart(index : number) {\n        console.error(\"onLoadstart  video\" + index);\n      },\n      getVideoContext(index : number) : VideoContext {\n        const videoContextMap = this.$data['$videoContextMap'] as Map<string, VideoContext>\n        let videoContext : VideoContext | null = videoContextMap.get('video-' + index)\n        if (videoContext == null) {\n          videoContext = uni.createVideoContext('video-' + index, this) as VideoContext\n          videoContextMap.set('video-' + index, videoContext)\n        }\n        return videoContext\n      },\n      doPlay(index : number) {\n        console.log(\"doPlay  video\" + index);\n        this.getVideoContext(index).play()\n      },\n      doStop(index : number) {\n        console.log(\"doStop  video-\" + index);\n        this.getVideoContext(index).stop();\n        // TODO 临时方案：解决.stop()时触发了doPause的问题\n        setTimeout(() => {\n          this.state[index] = 'unPlay'\n        }, 1000)\n      },\n      doPause(index : number) {\n        this.getVideoContext(index).pause()\n        console.log(\"doPause  video-\" + index);\n      },\n      onPause(index : number) {\n        this.state[index] = 'pause'\n        console.log('onPause', index);\n      },\n      onPlay(index : number) {\n        if (this.current != index || !currentPageIsShow) {\n          this.onPause(index)\n        } else {\n          this.state[index] = 'play'\n          console.log('onPlay', index);\n        }\n      },\n      getData() : ListItem[] {\n        let videoUrlList = [\n          'https://web-ext-storage.dcloud.net.cn/uni-app-x/video/uts-5-16.mp4',\n          'https://web-ext-storage.dcloud.net.cn/uni-app-x/video/uni-ai-5-16.mp4',\n          'https://web-ext-storage.dcloud.net.cn/uni-app-x/video/uni-verify-5-16.mp4'\n        ] as string[]\n\n        let posterSrcList = [\n          'https://web-ext-storage.dcloud.net.cn/uni-app-x/dark-uni-uts-01.png',\n          'https://web-ext-storage.dcloud.net.cn/uni-app-x/dark-uni-ai-01.png',\n          'https://web-ext-storage.dcloud.net.cn/uni-app-x/dark-uni-verify-01.jpg'\n        ] as string[]\n\n        let list = [] as ListItem[];\n        for (let i = 0; i < 6; i++) {\n          let index = this.list.length + i;\n          let listItem : ListItem = {\n            \"_id\": \"a00\" + index,\n            \"content\": \"这是第\" + index + \"条数据，url地址\" + videoUrlList[i % 3],\n            \"src\": videoUrlList[i % 3],\n            \"poster_src\": posterSrcList[i % 3]\n          }\n          list.push(listItem)\n        }\n        return list\n      },\n      onSwiperChange(e : SwiperChangeEvent) {\n        // console.error('SwiperChangeEvent',e.detail.current);\n        this.current = e.detail.current;\n      },\n      onTransition(/*e : SwiperTransitionEvent*/) {\n        // console.log('onTransition e.detail.dx', e.detail.dx);\n      },\n      back() {\n        uni.navigateBack({\n          success(result) {\n            console.log('navigateBack success', result.errMsg)\n          },\n          fail(error) {\n            console.log('navigateBack fail', error.errMsg)\n          },\n          complete(result) {\n            console.log('navigateBack complete', result.errMsg)\n          }\n        })\n      }\n    }\n  }\n</script>\n\n<style>\n  .page {\n    flex: 1;\n  }\n\n  .swiper,\n  .swiper-item,\n  .video-box,\n  .video-cover {\n    width: 100%;\n    flex: 1;\n    height: 100%;\n  }\n\n  .swiper-item {\n    position: relative;\n  }\n\n  .video-box {\n    width: 100%;\n  }\n\n  .video-cover {\n    position: absolute;\n    justify-content: center;\n    align-items: center;\n    align-content: center;\n  }\n\n  .play-btn {\n    width: 40px;\n    height: 40px;\n  }\n\n  .video-info {\n    position: absolute;\n    bottom: 0;\n    padding: 15px;\n  }\n\n  .video-info-text {\n    font-size: 14px;\n    color: red;\n    line-height: 20px;\n  }\n\n  .debug-info {\n    position: fixed;\n    top: 15px;\n    width: 100%;\n    background-color: rgba(255, 255, 255, 0.3);\n  }\n\n  .status-text {\n    color: red;\n    padding: 15px;\n  }\n\n  .nav-back {\n    position: absolute;\n\n    top: 35px;\n\n    background-color: rgba(220, 220, 220, 0.8);\n    border-radius: 100px;\n    margin: 6px;\n    width: 32px;\n    height: 32px;\n    justify-content: center;\n    align-items: center;\n    z-index: 10;\n  }\n\n  .nav-back .back-img {\n    width: 18px;\n    height: 18px;\n  }\n</style>\n",null,null,null,null],"names":[],"mappings":"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"}