{"version":3,"sources":["pages/template/long-list/long-list-page.uvue","pages/API/request/request.uvue?type=page"],"sourcesContent":["<template>\n  <list-view ref=\"listView\" :id=id class=\"list\" :rebound=\"false\" :scroll-y=\"true\" :custom-nested-scroll=\"true\"\n    @scrolltolower=\"loadData(null)\" associative-container=\"nested-scroll-view\">\n    <list-item class=\"list-item\" v-for=\"(item, _) in dataList\" :key=\"item.plugin_id\">\n      <view class=\"list-item-icon\">\n        <image class=\"list-item-icon-image\" :src=\"item.plugin_img_link\"></image>\n      </view>\n      <view class=\"list-item-fill\">\n        <view class=\"flex-row\">\n          <text class=\"title\">{{item.plugin_name}}</text>\n        </view>\n        <view>\n          <text class=\"description-text\">{{item.plugin_intro}}</text>\n        </view>\n        <text class=\"icon-star\">{{convertToStarUnicode(item.score)}}</text>\n        <view class=\"tag-list\">\n          <text class=\"tag-item\" v-for=\"(item2, index2) in item.tags\" :key=\"index2\">{{item2}}</text>\n        </view>\n        <view class=\"flex-row update-date\">\n          <text class=\"update-date-text\">更新日期</text>\n          <text class=\"update-date-value\">{{item.update_date}}</text>\n          <text class=\"author\">{{item.author_name}}</text>\n        </view>\n      </view>\n    </list-item>\n    <list-item class=\"loading\">\n      <uni-loading :loading=\"loading\" color=\"#999\" :text=\"loadingText\"></uni-loading>\n    </list-item>\n  </list-view>\n</template>\n\n<script>\n  const SERVER_URL = \"https://unidemo.dcloud.net.cn/plugin/uniappx-plugin-list\"\n  const PAGE_SIZE = 10; // 最大值 10\n\n  type ListItem = {\n    plugin_id : number,\n    plugin_img_link : string,\n    plugin_name : string,\n    plugin_intro : string,\n    score : number,\n    tags : Array<string>,\n    update_date : string,\n    author_name : string,\n  }\n\n  type ResponseDataType = {\n    code : number,\n    data : ListItem[]\n  }\n\n  export default {\n    props: {\n      type: {\n        type: String,\n        default: ''\n      },\n      preload: {\n        type: Boolean,\n        default: false\n      },\n      id: {\n        type: String,\n        default: ''\n      }\n    },\n    data() {\n      return {\n        loading: false,\n        dataList: [] as ListItem[],\n        isEnded: false,\n        loadingError: '',\n        currentPage: 1\n      }\n    },\n    computed: {\n      loadingText() : string {\n        if (this.loading) {\n          return \"加载中...\"\n        } else if (this.isEnded) {\n          return \"没有更多了\"\n        } else if (this.loadingError.length > 0) {\n          return this.loadingError\n        } else {\n          return \"\"\n        }\n      }\n    },\n    created() {\n      if (this.preload) {\n        this.loadData(null)\n      }\n    },\n    methods: {\n      refreshData(loadComplete : (() => void) | null) {\n        this.dataList.length = 0\n        this.currentPage = 1\n        this.loadData(loadComplete)\n      },\n      loadData(loadComplete : (() => void) | null) {\n        if (this.loading || this.isEnded) {\n          return\n        }\n        this.loading = true\n\n        uni.request<ResponseDataType>({\n          url: SERVER_URL,\n          data: {\n            type: this.type,\n            page: this.currentPage,\n            page_size: PAGE_SIZE\n          },\n          success: (res) => {\n            const responseData = res.data\n            if (responseData == null) {\n              return\n            }\n\n            this.dataList.push(...responseData.data)\n\n            if (responseData.data.length == 0) {\n              this.isEnded = true\n            } else {\n              this.currentPage++\n            }\n          },\n          fail: (err) => {\n            this.loadingError = err.errMsg\n          },\n          complete: () => {\n            this.loading = false\n            if (loadComplete != null) {\n              loadComplete()\n            }\n          }\n        })\n      },\n      // score 0 ~ 50\n      convertToStarUnicode(score : number) : string {\n        const fill_code = '\\ue879'\n        const half_code = '\\ue87a'\n        const null_code = '\\ue87b'\n\n        const fillStarCount = parseInt(score / 10 % 10 + '')\n        const halfStarCount = score % 10 >= 5 ? 1 : 0\n        const nullStarCount = 5 - fillStarCount - halfStarCount\n\n        let result = ''\n        if (fillStarCount > 0) { result += fill_code.repeat(fillStarCount) }\n        if (halfStarCount > 0) { result += half_code.repeat(halfStarCount) }\n        if (nullStarCount > 0) { result += null_code.repeat(nullStarCount) }\n\n        return result\n      }\n    }\n  }\n</script>\n\n<style>\n  @font-face {\n    font-family: \"UtsStarIcons\";\n    src: url('@/static/fonts/icon-star.ttf');\n  }\n\n  .list {\n    flex: 1;\n    background-color: #ffffff;\n  }\n\n  .list-item {\n    flex-direction: row;\n    margin-top: 10px;\n    padding: 10px;\n  }\n\n  .list-item-icon {\n    position: relative;\n  }\n\n  .list-item-icon-image {\n    width: 80px;\n    height: 80px;\n  }\n\n  .list-item-fill {\n    flex: 1;\n    margin-left: 15px;\n  }\n\n  .description-text {\n    font-size: 13px;\n    color: #666;\n    line-height: 19px;\n  }\n\n  .icon-star {\n    font-family: \"UtsStarIcons\";\n    font-size: 16px;\n    font-style: normal;\n    color: #ffca3e;\n    letter-spacing: 3px;\n  }\n\n  .tag-list {\n    flex-direction: row;\n    margin-top: 5px;\n  }\n\n  .tag-item {\n    font-size: 12px;\n    background-color: #EFF9F0;\n    color: #639069;\n    border-radius: 20px;\n    margin-right: 5px;\n    padding: 2px 5px;\n  }\n\n  .update-date {\n    margin-top: 10px;\n  }\n\n  .update-date-text {\n    font-size: 12px;\n    color: #888888;\n  }\n\n  .update-date-value {\n    font-size: 12px;\n    color: #777777;\n    margin-left: 5px;\n  }\n\n  .author {\n    font-size: 12px;\n    color: #008000;\n    margin-left: auto;\n  }\n\n  .loading {\n    padding: 30px;\n    align-items: center;\n  }\n\n  .flex-row {\n    flex-direction: row;\n  }\n</style>\n",null],"names":[],"mappings":"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"}