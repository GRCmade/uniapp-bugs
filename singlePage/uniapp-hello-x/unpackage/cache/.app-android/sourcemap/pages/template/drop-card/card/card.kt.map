{"version":3,"sources":["pages/template/drop-card/card/card.uvue","pages/component/unicloud-db-contacts/add.uvue?type=page","pages/component/unicloud-db-contacts/list.uvue?type=page","pages/API/get-system-info/get-system-info.uvue?type=page"],"sourcesContent":["<template>\n  <view class=\"card\" ref=\"card\" @touchstart=\"touchstart($event as TouchEvent)\"\n    @touchmove=\"touchmove($event as TouchEvent)\" @touchend=\"touchend\" @touchcancel=\"touchend\">\n    <image class=\"card-img\" ref=\"card-img\" :src=\"img\"></image>\n    <view class=\"state\">\n      <image class=\"state-icon like\" ref=\"state-icon-like\" src=\"/static/template/drop-card/like.png\" mode=\"widthFix\">\n      </image>\n      <image class=\"state-icon dislike\" ref=\"state-icon-dislike\" src=\"/static/template/drop-card/dislike.png\"\n        mode=\"widthFix\"></image>\n      <!-- cardIndex:{{cardIndex}} -->\n    </view>\n  </view>\n</template>\n<script>\n  let sX : number = 0,\n    sY : number = 0,\n    screenWidth : number = 1,\n    screenHeight : number = 1,\n    floating : boolean = false,\n    touchstartAfter : boolean = false;\n  export default {\n    data() {\n      return {\n        $elementMap: new Map<string, UniElement>(),\n        x: 0 as number,\n        y: 0 as number,\n        // 飘走的卡片计数\n        floatCount: 0 as number\n      }\n    },\n    props: {\n      img: {\n        type: String,\n        default: \"/static/template/drop-card/1.jpg\"\n      },\n      cardIndex: {\n        type: Number,\n        default: 0\n      }\n    },\n    computed: {\n      movePercent() : number {\n        return Math.abs(this.x) / (screenWidth / 2 * 3)\n      },\n      likeOpacity() : number {\n        return this.x < 0 ? 0 : this.movePercent * 100\n      },\n      dislikeOpacity() : number {\n        return this.x > 0 ? 0 : this.movePercent * 100\n      }\n    },\n    mounted() {\n      uni.getSystemInfo({\n        success: (e) => {\n          screenWidth = e.screenWidth;\n          screenHeight = e.screenHeight;\n        }\n      })\n\n      // TODO 需要延迟设置才能生效\n      setTimeout(() => {\n        this.setElementStyle('card', 'height', screenHeight * 0.7 + 'px');\n        this.setElementStyle('card-img', 'height', screenHeight * 0.7 + 'px');\n        this.initCardStyle()\n      }, 200)\n\n      uni.$on('uni-drop-card-float', () => {\n        this.floatCount++\n        this.initCardStyle()\n      })\n\n    },\n    methods: {\n      initCardStyle() {\n        let _index = (this.cardIndex + this.floatCount) % 3\n        // console.log('~~~~~~_index:'+_index + ' cardIndex:'+this.cardIndex+' floatCount:'+this.floatCount);\n        this.setElementStyle('card', 'z-index', _index)\n        this.setElementStyle('card', 'margin-top', screenHeight * 0.15 - 30 * _index + 'px');\n        this.setElementStyle('card', 'transform', 'scale(' + (0.9 + 0.05 * _index) + ')')\n      },\n      // 工具方法，用于快速设置 Element 的 style\n      setElementStyle(refName : string, propertyName : string, propertyStyle : any) : void {\n        const elementMap = this.$data['$elementMap'] as Map<string, UniElement>\n        let element : UniElement | null = elementMap.get(refName)\n        if (element == null) {\n          element = this.$refs[refName] as UniElement;\n          elementMap.set(refName, element)\n        } else {\n          // console.log('直接拿');\n        }\n        element.style.setProperty(propertyName, propertyStyle);\n      },\n      touchstart(e : TouchEvent) {\n        // console.log('touchstart')\n        if (floating) {\n          return // 浮动动画进行中\n        }\n        sX = e.touches[0].screenX;\n        sY = e.touches[0].screenY;\n        this.x = 0\n        this.y = 0\n\n        touchstartAfter = true\n      },\n      touchmove(e : TouchEvent) {\n        // console.log('touchmove')\n        if (!touchstartAfter || floating) {\n          return // floating：浮动动画进行中\n        }\n        this.x += e.touches[0].screenX - sX;\n        this.y += e.touches[0].screenY - sY;\n        sX = e.touches[0].screenX;\n        sY = e.touches[0].screenY;\n        this.moveCard()\n\n\n\n\n      },\n      touchend() {\n        // console.log('touchend')\n        touchstartAfter = false\n        if (floating) {\n          return // 浮动动画进行中\n        }\n        floating = true\n\n        // 设置释放之后飘走的方向 0回到坐标中心 1向右 2向左\n        let k : number = 0;\n        if (this.x > screenWidth / 10) {\n          k = 1\n        } else if (this.x < screenWidth * -1 / 10) {\n          k = -1\n        }\n\n        const _this = this\n        function cardTo(x : number, y : number, callback : () => void, speed : number = 10) {\n          let interval : number = 0\n          let acceleration : number = 1\n          interval = setInterval(() => {\n            // 加速度\n            acceleration += 0.2\n\n            const dx = x - _this.x\n            if (Math.abs(dx) < 1) {\n              _this.x = x\n            } else {\n              _this.x += dx / speed * acceleration\n            }\n\n            const dy = y - _this.y\n            if (Math.abs(dy) < 1) {\n              _this.y = y\n            } else {\n              _this.y += dy / speed * acceleration\n            }\n\n            _this.moveCard()\n            if (_this.x == x && _this.y == y) {\n              clearInterval(interval)\n              callback()\n            }\n          }, 16)\n        }\n\n        if (Math.floor(k) != 0) {\n          cardTo(k * screenWidth * 1.3, this.y * 3, () => {\n            //  状态图标变回透明\n            this.setElementStyle(\"state-icon-like\", 'opacity', 0)\n            this.setElementStyle(\"state-icon-dislike\", 'opacity', 0)\n\n            // 设置为透明，防止飘回时因为 margin-top 太高，露出来\n            this.setElementStyle(\"card\", 'opacity', 0)\n            setTimeout(() => {\n              this.setElementStyle(\"card\", 'opacity', 1)\n            }, 300)\n\n            // 执行卡片飘动后事件，注意uni.$emit是全局事件。其他卡片也会执行\n            uni.$emit('uni-drop-card-float', null)\n            floating = false\n          }, 8)\n        } else {\n          const _x : number = this.x\n          const _y : number = this.y\n          cardTo(Math.floor(_x * -0.05), Math.floor(_y * -0.05), () => {\n            cardTo(0, 0, () => {\n              console.log('bounce')\n              floating = false\n            }, 30)\n          })\n        }\n      },\n      moveCard() {\n        this.setElementStyle(\"card\",\n          'transform',\n          `translate(${this.x}px,${this.y}px) rotate(${this.x / -30}deg) scale(1)`\n        )\n        this.setElementStyle(\"state-icon-like\", 'opacity', this.x < 0 ? 0 : this.movePercent * 10)\n        this.setElementStyle(\"state-icon-dislike\", 'opacity', this.x > 0 ? 0 : this.movePercent * 10)\n      }\n    }\n  }\n</script>\n\n<style>\n  .card {\n    width:95%;\n    height: 0px;\n    position: absolute;\n    top: 0px;\n    /* left: 0px; */\n    margin: 0 12px;\n    margin-top: 50px;\n    border-radius: 10px;\n    box-shadow: 0 0 5px rgba(0, 0, 0, 0.1);\n    background-color: #FFF;\n    transition: margin-top 300ms;\n    transition-timing-function: ease-in;\n  }\n\n  .card-img {\n    width: 100%;\n    height: 0px;\n    border-radius: 10px;\n  }\n\n  .state {\n    top: 10px;\n    left: 10px;\n    width: 86%;\n    padding: 4px;\n    position: absolute;\n    flex-direction: row;\n    justify-content: space-between;\n  }\n\n  .state-icon {\n    width: 30px;\n    height: 30px;\n    border: 1px solid #FFF;\n    background-color: #FFF;\n    padding: 3px;\n    border-radius: 100px;\n    box-shadow: 0 0 1px #EBEBEB;\n    opacity: 0;\n  }\n</style>\n",null,null,null],"names":[],"mappings":"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"}