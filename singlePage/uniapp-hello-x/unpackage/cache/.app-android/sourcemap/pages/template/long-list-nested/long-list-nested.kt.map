{"version":3,"sources":["pages/template/long-list-nested/long-list-nested.uvue","pages/component/unicloud-db-contacts/list.uvue?type=page","pages/template/long-list-nested/long-list-nested.uvue?type=page"],"sourcesContent":["<template>\n  <scroll-view ref=\"pageScrollView\" class=\"page\" :rebound=\"false\" type=\"nested\">\n    <nested-scroll-header>\n      <swiper ref=\"header\" indicator-dots=\"true\" circular=\"true\">\n        <swiper-item v-for=\"i in 3\" :item-id=\"i\">\n          <image src=\"/static/shuijiao.jpg\" style=\"width:100% ;height: 240px;\"></image>\n          <text style=\"position: absolute;\">{{i}}</text>\n        </swiper-item>\n      </swiper>\n    </nested-scroll-header>\n    <nested-scroll-body style=\"height: 100%;\">\n      <view style=\"flex: 1;\">\n        <scroll-view ref=\"tabScroll\" class=\"swiper-tabs\" direction=\"horizontal\" :show-scrollbar=\"false\">\n          <view class=\"flex-row\" style=\"align-self: flex-start;\">\n            <text ref=\"swipertab\" class=\"swiper-tabs-item\" :class=\"swiperIndex==index ? 'swiper-tabs-item-active' : ''\"\n              v-for=\"(item, index) in swiperList\" :key=\"index\" @click=\"onTabClick(index)\">\n              {{item.name}}\n            </text>\n          </view>\n          <view ref=\"indicator\" class=\"swiper-tabs-indicator\"></view>\n        </scroll-view>\n        <swiper ref=\"swiper\" class=\"swiper-view\" :current=\"swiperIndex\" @transition=\"onSwiperTransition\"\n          @animationfinish=\"onSwiperAnimationfinish\">\n          <swiper-item class=\"swiper-item\" v-for=\"(item, index) in swiperList\" :key=\"index\">\n            <long-page ref=\"longPage\" :id=\"item.id\" :type=\"item.type\" :preload=\"item.preload\"></long-page>\n          </swiper-item>\n        </swiper>\n      </view>\n    </nested-scroll-body>\n  </scroll-view>\n</template>\n\n<script>\n  import longPage from '../long-list/long-list-page.uvue';\n\n  type SwiperTabsItem = {\n    x : number,\n    w : number\n  }\n\n  type SwiperViewItem = {\n    type : string,\n    name : string,\n    id : string,\n    preload : boolean,\n  }\n\n  /**\n   * 根据权重在两个值之间执行线性插值.\n   * @constructor\n   * @param {number} value1 - 第一个值，该值应为下限.\n   * @param {number} value2 - 第二个值，该值应为上限.\n   * @param {number} amount - 应介于 0 和 1 之间，指示内插的权重.\n   * @returns {number} 内插值\n   */\n  function lerpNumber(value1 : number, value2 : number, amount : number) : number {\n    return (value1 + (value2 - value1) * amount)\n  }\n\n  export default {\n    components: {\n      longPage\n    },\n    data() {\n      return {\n        swiperList: [\n          {\n            type: 'UpdatedDate',\n            name: '最新上架',\n            id: \"list-id-1\",\n            preload: true\n          } as SwiperViewItem,\n          {\n            type: 'FreeHot',\n            name: '免费热榜',\n            id: \"list-id-2\",\n            preload: false\n          } as SwiperViewItem,\n          {\n            type: 'PaymentHot',\n            name: '付费热榜',\n            id: \"list-id-3\",\n            preload: false\n          } as SwiperViewItem,\n          {\n            type: 'HotList',\n            name: '热门总榜',\n            id: \"list-id-4\",\n            preload: false\n          } as SwiperViewItem\n        ] as SwiperViewItem[],\n        swiperIndex: 0,\n        pageScrollView: null as null | UniElement,\n        headerHeight: 0,\n        animationFinishIndex: 0,\n        tabScrollView: null as null | UniElement,\n        indicatorNode: null as null | UniElement,\n        swiperWidth: 0,\n        swiperTabsRect: [] as SwiperTabsItem[],\n        nestedScrollChildId: \"\"\n      }\n    },\n    onReady() {\n      this.pageScrollView = this.$refs['pageScrollView'] as UniElement;\n      this.headerHeight = (this.$refs['header'] as UniElement).offsetHeight\n      this.swiperWidth = (this.$refs['swiper'] as UniElement).getBoundingClientRect().width\n      this.tabScrollView = this.$refs['tabScroll'] as UniElement\n      this.indicatorNode = this.$refs['indicator'] as UniElement\n      this.cacheTabItemsSize()\n      this.updateTabIndicator(this.swiperIndex, this.swiperIndex, 1)\n    },\n    onPullDownRefresh() {\n      (this.$refs[\"longPage\"]! as ComponentPublicInstance[])[this.swiperIndex].$callMethod('refreshData', () => {\n        uni.stopPullDownRefresh()\n      })\n    },\n    methods: {\n      onTabClick(index : number) {\n        this.setSwiperIndex(index, false)\n      },\n      onSwiperTransition(e : SwiperTransitionEvent) {\n        // 微信 skyline 每项完成触发 Animationfinish，偏移值重置\n        // 微信 webview 全部完成触发 Animationfinish，偏移值累加\n        // 在滑动到下一个项的过程中，再次反向滑动，偏移值递减\n        // uni-app-x 和微信 webview 行为一致\n\n        const offset_x = e.detail.dx\n\n        // 计算当前索引并重置差异\n        const current_offset_x = offset_x % this.swiperWidth\n        const current_offset_i = offset_x / this.swiperWidth\n        const current_index = this.animationFinishIndex + parseInt(current_offset_i + '')\n\n        // 计算目标索引及边界检查\n        let move_to_index = current_index\n        if (current_offset_x > 0 && move_to_index < this.swiperList.length - 1) {\n          move_to_index += 1\n        } else if (current_offset_x < 0 && move_to_index > 0) {\n          move_to_index -= 1\n        }\n\n        // 计算偏移百分比\n        const percentage = Math.abs(current_offset_x) / this.swiperWidth\n\n        // 通知更新指示线\n        if (current_index != move_to_index) {\n          this.updateTabIndicator(current_index, move_to_index, percentage)\n        }\n\n        // 首次可见时初始化数据\n        this.initSwiperItemData(move_to_index)\n      },\n      onSwiperAnimationfinish(e : SwiperAnimationFinishEvent) {\n        this.setSwiperIndex(e.detail.current, true)\n        this.animationFinishIndex = e.detail.current\n      },\n      cacheTabItemsSize() {\n        this.swiperTabsRect.length = 0\n        const tabs = this.$refs[\"swipertab\"] as UniElement[]\n        tabs.forEach((node) => {\n          this.swiperTabsRect.push({\n            x: node.offsetLeft,\n            w: node.offsetWidth\n          } as SwiperTabsItem)\n        })\n      },\n      setSwiperIndex(index : number, updateIndicator : boolean) {\n        if (this.swiperIndex === index) {\n          return\n        }\n\n        this.swiperIndex = index\n\n        this.initSwiperItemData(index)\n\n        if (updateIndicator) {\n          this.updateTabIndicator(index, index, 1)\n        }\n      },\n      updateTabIndicator(current_index : number, move_to_index : number, percentage : number) {\n        const current_size = this.swiperTabsRect[current_index]\n        const move_to_size = this.swiperTabsRect[move_to_index]\n\n        // 计算指示线 左边距 和 宽度 在移动过程中的线性值\n        const indicator_line_x = lerpNumber(current_size.x, move_to_size.x, percentage)\n        const indicator_line_w = lerpNumber(current_size.w, move_to_size.w, percentage)\n\n        // 更新指示线\n\n        const x = indicator_line_x + indicator_line_w / 2\n        this.indicatorNode?.style?.setProperty('transform', `translateX(${x}px) scaleX(${indicator_line_w})`)\n\n\n\n\n\n\n\n\n        // 滚动到水平中心位置\n        const scroll_x = x - this.swiperWidth / 2\n        if (this.tabScrollView !== null) {\n          this.tabScrollView!.scrollLeft = scroll_x\n        }\n      },\n      initSwiperItemData(index : number) {\n        if (!this.swiperList[index].preload) {\n          this.swiperList[index].preload = true;\n          (this.$refs[\"longPage\"]! as ComponentPublicInstance[])[index].$callMethod('loadData', null)\n        }\n        //swiper页面切换需要重新赋值嵌套滚动子元素的id\n        this.nestedScrollChildId = this.swiperList[index].id\n      }\n    }\n  }\n</script>\n\n<style>\n  .flex-row {\n    flex-direction: row;\n  }\n\n  .page {\n    flex: 1;\n  }\n\n  .search-bar {\n    padding: 10px;\n  }\n\n  .swiper-list {\n    height: 100%;\n\n\n\n  }\n\n  .swiper-tabs {\n    background-color: #ffffff;\n    flex-direction: column;\n  }\n\n  .swiper-tabs-item {\n    color: #555;\n    font-size: 16px;\n    padding: 12px 25px;\n    white-space: nowrap;\n  }\n\n  .swiper-tabs-item-active {\n    color: #007AFF;\n  }\n\n  .swiper-tabs-indicator {\n    width: 1px;\n    height: 2px;\n    background-color: #007AFF;\n  }\n\n  .swiper-view {\n    flex: 1;\n  }\n\n  .swiper-item {\n    flex: 1;\n  }\n</style>\n",null,null],"names":[],"mappings":"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"}