{"version":3,"sources":["pages/template/half-screen/half-screen.uvue","pages/component/list-view/list-view-multiplex.uvue?type=page","pages/API/action-sheet/action-sheet.uvue?type=page","pages/template/half-screen/half-screen.uvue?type=page"],"sourcesContent":["<template>\n  <view id=\"page\" class=\"page\">\n    <text\n      style=\"margin: 10px\">半屏弹窗，演示了弹出层内scroll-view滚动到顶时由滚变拖。本效果是通过监听TouchEvent实现，当半屏窗口移动时禁用scroll-view的滚动，避免两者的冲突。</text>\n    <button class=\"bottomButton\" @click=\"switchHalfScreen(true)\">打开弹窗</button>\n    <view ref=\"halfScreen\" class=\"halfScreen\" @touchstart=\"onHalfTouchStart\" @touchmove=\"onHalfTouchMove\"\n      @touchend=\"onHalfTouchEnd\">\n      <view class=\"halfTitle\">半屏弹窗标题</view>\n      <scroll-view ref=\"halfScroll\" class=\"halfScroll\" rebound=\"true\" :direction=\"scrollDirection\">\n        <view v-for=\"(item,index) in list\" :key=\"index\" class=\"item\">\n          half screen content-{{item}}\n        </view>\n      </scroll-view>\n    </view>\n  </view>\n</template>\n\n<script>\n  export default {\n    data() {\n      return {\n        list: ['1', '2', '3', '4', '5', '6', '7', '8', '9', '10', '11', '12', '13', '14', '15'],\n        totalHeight: 0,\t\t//总高度\n        halfMove: false,\t//是否Move，响应TouchMove\n        halfScreenY: 0,\t\t//响应TouchMove的起始点Y坐标\n        halfOffset: 0,\t\t//偏移的位置，translateY\n        halfHeight: 0,\t\t//高度\n        lastY: 0,\t\t\t//上次\n        lastY2: 0,\t\t\t//\n        bAnimation: false,\t//是否动画\n        halfNode: null as UniElement | null,\n        scrollNode: null as UniElement | null,\n        scrollDirection: 'vertical'\n      }\n    },\n    methods: {\n      onHalfTouchStart(_ : TouchEvent) {\n        this.halfNode?.style?.setProperty('transition-duration', 0);\n      },\n      onHalfTouchMove(e : TouchEvent) {\n        if (this.bAnimation) {//容错处理\n          return;\n        }\n        let top : number = this.scrollNode?.scrollTop ?? 0;\n        let p = e.touches[0];\n        this.lastY2 = this.lastY;\n        this.lastY = p.screenY;\n        if (top <= 0.01 || this.halfMove) {\n          if (this.halfScreenY == 0) {\n            this.halfScreenY = p.screenY;\n          }\n          let offset = p.screenY - this.halfScreenY;\n          if (offset > 0) {//向下滚动\n            this.halfMove = true;\n\n            //this.scrollNode?.setAttribute('scroll-y', 'false');\n            this.scrollNode?.setAttribute('direction', 'none');\n\n\n\n\n            this.halfNode?.style?.setProperty('transform', 'translateY(' + offset.toFixed(2) + 'px)');\n            this.halfOffset = offset;\n          } else if (this.halfOffset > 0) {//向上滚动\n            offset = this.halfScreenY - p.screenY;\n            if (offset > this.halfOffset) {\n              offset = 0;\n              this.halfMove = false;\n            }\n\n            //this.scrollNode?.setAttribute('scroll-y', 'true');\n            this.scrollNode?.setAttribute('direction', 'vertical');\n\n\n\n\n            this.halfNode?.style?.setProperty('transform', 'translateY(' + offset.toFixed(2) + 'px)');\n            this.halfOffset = offset;\n          }\n        }\n\n\n\n      },\n      onHalfTouchEnd(_ : TouchEvent) {\n        this.halfScreenY = 0;\n        if (this.bAnimation) {//容错处理\n          return;\n        }\n        let top : number = this.scrollNode?.scrollTop ?? 0;\n        let bHide = (this.halfHeight - this.halfOffset) < this.halfHeight / 4;\n        if (bHide) {\n          bHide = this.lastY2 > 0 && this.lastY2 <= this.lastY;\n        } else if (top <= 0.01) {\n          bHide = (this.lastY - this.lastY2) > 3;\t\t//向下滑动计算加速度判断是否关闭，简单处理未考虑时间\n        }\n        if (bHide) {\n          this.switchHalfScreen(false);\n        } else if (this.halfOffset > 0) {\n          this.resumeHalfScreen();\n        }\n      },\n      switchHalfScreen(show : boolean) {\n        if (show && ('visible' == this.halfNode?.style?.getPropertyValue('visibility'))) {//容错处理\n          console.log('quick click button!!!');\n          return;\n        }\n        this.halfMove = false;\n\n        //this.scrollNode?.setAttribute('scroll-y', 'true');\n        this.scrollNode?.setAttribute('direction', 'vertical');\n\n\n\n\n        this.halfScreenY = 0;\n        this.halfOffset = 0;\n        let top = this.totalHeight;\n        let time = 300;\n        if (show) {\n          top = this.totalHeight * 30 / 100;\t//计算显示的位置\n          this.halfNode?.style?.setProperty('visibility', 'visible');\n          this.halfNode?.style?.setProperty('transition-timing-function', 'ease-in-out');\n        } else {\n          this.halfNode?.style?.setProperty('transition-timing-function', 'linear');\n          time *= (this.halfHeight / this.totalHeight);\t\t//计算关闭动画时间\n        }\n        this.halfNode?.style?.setProperty('transition-duration', time.toFixed(0)+'ms');\n        this.halfNode?.style?.setProperty('transition-property', 'top');\n        this.halfNode?.style?.setProperty('top', top.toFixed(2)+'px');\n        setTimeout(() => {\n          if (!show) {\n            this.halfNode?.style?.setProperty('visibility', 'hidden');\n            this.halfNode?.style?.setProperty('transition-duration', 0);\n            this.halfNode?.style?.setProperty('transform', '');\n          }\n          this.halfNode?.style?.setProperty('transition-property', 'none');\n          this.bAnimation = false;\n        }, time)\n        this.bAnimation = true;\n      },\n      resumeHalfScreen() {\n        let time = 300;//(500*this.halfOffset/this.halfHeight).toFixed(0); //回弹动画时间\n        this.halfNode?.style?.setProperty('transition-duration', time.toFixed(0)+'ms');\n        this.halfNode?.style?.setProperty('transition-timing-function', 'ease-in-out');\n        this.halfNode?.style?.setProperty('transition-property', 'transform');\n        this.halfNode?.style?.setProperty('transform', 'translateY(0px)');\n        this.halfMove = false;\n\n        //this.scrollNode?.setAttribute('scroll-y', 'true');\n        this.scrollNode?.setAttribute('direction', 'vertical');\n\n\n\n\n        this.halfScreenY = 0;\n        this.halfOffset = 0;\n        setTimeout(() => {\n          this.bAnimation = false;\n          this.halfNode?.style?.setProperty('transition-property', 'none');\n        }, time)\n        this.bAnimation = true;\n      }\n    },\n    onReady() {\n      this.halfNode = this.$refs['halfScreen'] as UniElement;//uni.getElementById('halfScreen');\n      this.scrollNode = this.$refs['halfScroll'] as UniElement;//uni.getElementById('halfScroll');\n\n      this.halfHeight = this.halfNode!.getBoundingClientRect().height;\n      this.totalHeight = uni.getElementById('page')?.getBoundingClientRect()?.height ?? 0;//uni.getWindowInfo().windowHeight\n      this.halfNode?.style?.setProperty('top', this.totalHeight.toFixed(2)+'px');\n    },\n    onResize() {\n      this.halfHeight = this.halfNode?.getBoundingClientRect()?.height ?? 0;\n      this.totalHeight = uni.getWindowInfo().windowHeight;\n      this.halfNode?.style?.setProperty('top', this.totalHeight.toFixed(2)+'px');\n      this.halfNode?.style?.setProperty('visibility', 'hidden');\n    },\n    onBackPress(): boolean {\n      if('visible' == this.halfNode?.style?.getPropertyValue('visibility')){\n        this.switchHalfScreen(false);\n        return true;\n      }\n      return false;\n    }\n  }\n</script>\n\n<style>\n  .page {\n    flex: 1;\n    background-color: darkgrey;\n  }\n\n  .bottomButton {\n    position: absolute;\n    width: 100%;\n    bottom: 0px;\n  }\n\n  .halfScreen {\n    position: absolute;\n    top: 100%;\n    width: 100%;\n    height: 70%;\n    transition-timing-function: ease-in-out;\n    /*ease ease-in ease-out ease-in-out linear step-start step-end*/\n    transition-property: top;\n    transition-duration: 0ms;\n    visibility: hidden;\n  }\n\n  .halfTitle {\n    align-items: center;\n    justify-content: center;\n    height: 48px;\n    background-color: ghostwhite;\n    border-radius: 10px 10px 0 0;\n  }\n\n  .halfScroll {\n    background-color: white;\n    flex: 1;\n  }\n\n  .item {\n    height: 100px;\n  }\n</style>\n",null,null,null],"names":[],"mappings":"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"}