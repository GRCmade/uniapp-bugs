{"version":3,"sources":["pages/template/swiper-list/swiper-list.uvue","pages/template/swiper-list/swiper-list.uvue?type=page"],"sourcesContent":["<template>\n  <view class=\"swiper-list\">\n    <scroll-view ref=\"tabScroll\" class=\"swiper-tabs\" direction=\"horizontal\" :show-scrollbar=\"false\">\n      <view class=\"flex-row\">\n        <text ref=\"swipertab\" space=\"nbsp\" class=\"swiper-tabs-item\" :class=\"swiperIndex==index ? 'swiper-tabs-item-active' : ''\"\n          v-for=\"(item, index) in swiperList\" :key=\"index\" @click=\"onTabClick(index)\">\n          {{item.title}}\n        </text>\n      </view>\n      <view ref=\"indicator\" class=\"swiper-tabs-indicator\"></view>\n    </scroll-view>\n    <swiper ref=\"swiper\" class=\"swiper-view\" :current=\"swiperIndex\" @transition=\"onSwiperTransition\"\n      @animationfinish=\"onSwiperAnimationfinish\">\n      <swiper-item class=\"swiper-item\" v-for=\"(_, index) in swiperList\" :key=\"index\">\n        <text class=\"swiper-item-text\">{{index}}</text>\n        <!-- 可以将上述text组件替换为list组件，实现可左右滑动的长列表 -->\n      </swiper-item>\n    </swiper>\n  </view>\n</template>\n\n<script>\n  type SwiperTabsItem = {\n    x : number,\n    w : number\n  }\n\n  type SwiperViewItem = {\n    title : string,\n  }\n\n  /**\n   * 根据权重在两个值之间执行线性插值.\n   * @constructor\n   * @param {number} value1 - 第一个值，该值应为下限.\n   * @param {number} value2 - 第二个值，该值应为上限.\n   * @param {number} amount - 应介于 0 和 1 之间，指示内插的权重.\n   * @returns {number} 内插值\n   */\n  function lerpNumber(value1 : number, value2 : number, amount : number) : number {\n    return (value1 + (value2 - value1) * amount)\n  }\n\n  export default {\n    data() {\n      return {\n        swiperList: [] as SwiperViewItem[],\n        swiperIndex: 0,\n        tabScrollView: null as null | UniElement,\n        indicatorNode: null as null | UniElement,\n        animationFinishIndex: 0,\n        swiperWidth: 0,\n        swiperTabsRect: [] as SwiperTabsItem[]\n      }\n    },\n    onLoad() {\n      // 初始化 8 个页签，宽度依次递增，用于演示在滑动 swiper 过程中指示线宽度的线性变化\n      for (let i = 0; i < 8; i++) {\n        const space = \" \".repeat(i)\n        this.swiperList.push({\n          title: \"Tab \" + space + i\n        } as SwiperViewItem)\n      }\n    },\n    onReady() {\n      this.tabScrollView = this.$refs['tabScroll'] as UniElement\n      this.indicatorNode = this.$refs['indicator'] as UniElement\n      this.swiperWidth = (this.$refs[\"swiper\"] as UniElement).getBoundingClientRect().width\n      this.cacheTabItemsSize()\n      this.updateTabIndicator(this.swiperIndex, this.swiperIndex, 1)\n    },\n    methods: {\n      /**\n       * 每个页签的点击事件，点击后设置当前 swiper.\n       * @constructor\n       * @param {number} index - 当前索引，该值应介于 0 和 最大数量之间.\n       */\n      onTabClick(index : number) {\n        this.setSwiperIndex(index, false)\n      },\n      onSwiperTransition(e : SwiperTransitionEvent) {\n        // 微信 skyline 每项完成触发 Animationfinish，偏移值重置\n        // 微信 webview 全部完成触发 Animationfinish，偏移值累加\n        // 在滑动到下一个项的过程中，再次反向滑动，偏移值递减\n        // uni-app-x 和 微信 webview 行为一致\n\n        const offset_x = e.detail.dx\n\n        // 计算当前索引并重置差异\n        const current_offset_x = offset_x % this.swiperWidth\n        const current_offset_i = offset_x / this.swiperWidth\n        const current_index = this.animationFinishIndex + parseInt(current_offset_i + '')\n\n        // 计算目标索引及边界检查\n        let move_to_index = current_index\n        if (current_offset_x > 0 && move_to_index < this.swiperList.length - 1) {\n          move_to_index += 1\n        } else if (current_offset_x < 0 && move_to_index > 0) {\n          move_to_index -= 1\n        }\n\n        // 计算偏移百分比\n        const percentage = Math.abs(current_offset_x) / this.swiperWidth\n\n        // 通知更新指示线\n        if (current_index != move_to_index) {\n          this.updateTabIndicator(current_index, move_to_index, percentage)\n        }\n      },\n      /**\n       * Swiper滑动动画结束事件.\n       */\n      onSwiperAnimationfinish(e : SwiperAnimationFinishEvent) {\n        this.setSwiperIndex(e.detail.current, true)\n\n        // 记录上次的索引位置\n        this.animationFinishIndex = e.detail.current\n      },\n      /**\n       * 缓存所有页签的左边距和宽度，用于计算指示线在移动过程中的线性变化.\n       */\n      cacheTabItemsSize() {\n        this.swiperTabsRect.length = 0;\n        const tabs = this.$refs[\"swipertab\"] as UniElement[]\n        tabs.forEach((node) => {\n          this.swiperTabsRect.push({\n            x: node.offsetLeft,\n            w: node.offsetWidth\n          } as SwiperTabsItem)\n        })\n      },\n      /**\n       * 设置当前 swiper 选中的索引值.\n       * @constructor\n       * @param {number} index - 当前索引，该值应介于 0 和 最大数量之间.\n       * @param {boolean} updateIndicator - 是否更新指示线.\n       */\n      setSwiperIndex(index : number, updateIndicator : boolean) {\n        if (this.swiperIndex === index) {\n          return\n        }\n\n        this.swiperIndex = index\n\n        if (updateIndicator) {\n          this.updateTabIndicator(index, index, 1)\n        }\n      },\n      /**\n       * 更新页签指示线的位置和宽度.\n       * @constructor\n       * @param {number} current_index - 当前索引，该值应介于 0 和 最大数量之间.\n       * @param {number} move_to_index - 目标索引，该值应介于 0 和 最大数量之间.\n       * @param {number} percentage - 偏移百分比，应介于 0 和 1 之间，用于计算在移动过程中的线性值.\n       */\n      updateTabIndicator(current_index : number, move_to_index : number, percentage : number) {\n        const current_size = this.swiperTabsRect[current_index]\n        const move_to_size = this.swiperTabsRect[move_to_index]\n\n        // 计算指示线 位置 和 宽度 在移动过程中的线性值\n        const indicator_line_x = lerpNumber(current_size.x, move_to_size.x, percentage)\n        const indicator_line_w = lerpNumber(current_size.w, move_to_size.w, percentage)\n\n        // 通过 transform 更新指示线，避免重排版\n\n        const x = indicator_line_x + indicator_line_w / 2\n        this.indicatorNode?.style?.setProperty('transform', `translateX(${x}px) scaleX(${indicator_line_w})`)\n\n\n\n\n\n\n\n\n        // 滚动到水平中心位置\n        const scroll_x = x - this.swiperWidth / 2\n        this.tabScrollView!.scrollLeft = scroll_x\n      }\n    }\n  }\n</script>\n\n<style>\n  .flex-row {\n    flex-direction: row;\n    align-self: flex-start;\n  }\n\n  .swiper-list {\n    flex: 1;\n  }\n\n  .swiper-tabs {\n    background-color: #ffffff;\n  }\n\n  .swiper-tabs-item {\n    color: #555;\n    font-size: 16px;\n    padding: 12px 25px;\n    white-space: nowrap;\n  }\n\n  .swiper-tabs-item-active {\n    color: #007AFF;\n  }\n\n  .swiper-tabs-indicator {\n    width: 1px;\n    height: 2px;\n    background-color: #007AFF;\n  }\n\n  .swiper-view {\n    flex: 1;\n  }\n\n  .swiper-item {\n    flex: 1;\n    align-items: center;\n    justify-content: center;\n  }\n\n  .swiper-item-text {\n    font-size: 72px;\n    font-weight: bold;\n  }\n</style>\n",null],"names":[],"mappings":"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"}