{"version":3,"sources":["pages/template/swiper-list2/swiper-list2.uvue","pages/template/swiper-list2/swiper-list2.uvue?type=page"],"sourcesContent":["<template>\n  <view class=\"swiper-list\">\n    <scroll-view ref=\"tabScroll\" class=\"swiper-tabs\" direction=\"horizontal\" :show-scrollbar=\"false\">\n      <view class=\"flex-row\" style=\"align-self: flex-start;\">\n        <text ref=\"swipertab\" class=\"swiper-tabs-item\" :class=\"swiperIndex==index ? 'swiper-tabs-item-active' : ''\"\n          v-for=\"(item, index) in swiperList\" :key=\"index\" @click=\"onTabClick(index)\">\n          {{item.title}}\n        </text>\n      </view>\n    </scroll-view>\n    <swiper ref=\"swiper\" class=\"swiper-view\" :current=\"swiperIndex\" @transition=\"onSwiperTransition\"\n      @animationfinish=\"onSwiperAnimationfinish\">\n      <swiper-item class=\"swiper-item\" v-for=\"(_, index) in swiperList\" :key=\"index\">\n        <text class=\"swiper-item-text\">{{index}}</text>\n        <!-- 可以将上述text组件替换为list组件，实现可左右滑动的长列表 -->\n      </swiper-item>\n    </swiper>\n  </view>\n</template>\n\n<script>\n  type SwiperViewItem = {\n    title : string,\n  }\n\n  /**\n   * 根据权重在两个值之间执行线性插值.\n   * @constructor\n   * @param {number} value1 - 第一个值，该值应为下限.\n   * @param {number} value2 - 第二个值，该值应为上限.\n   * @param {number} amount - 应介于 0 和 1 之间，指示内插的权重.\n   * @returns {number} 内插值\n   */\n  function lerpNumber(value1 : number, value2 : number, amount : number) : number {\n    return (value1 + (value2 - value1) * amount)\n  }\n\n  export default {\n    data() {\n      return {\n        swiperList: [] as SwiperViewItem[],\n        swiperIndex: 0,\n        tabScrollView: null as null | UniElement,\n        animationFinishIndex: 0,\n        swiperWidth: 0\n      }\n    },\n    onLoad() {\n      for (let i = 0; i < 4; i++) {\n        this.swiperList.push({\n          title: \"Tab \" + i\n        } as SwiperViewItem)\n      }\n    },\n    onReady() {\n      this.tabScrollView = this.$refs['tabScroll'] as UniElement\n      this.swiperWidth = (this.$refs[\"swiper\"] as UniElement).getBoundingClientRect().width\n      this.updateTabIndicator(this.swiperIndex, this.swiperIndex, 1)\n    },\n    methods: {\n      onTabClick(index : number) {\n        this.setSwiperIndex(index, false)\n      },\n      onSwiperTransition(e : SwiperTransitionEvent) {\n        const offset_x = e.detail.dx\n\n        // 计算当前索引并重置差异\n        const current_offset_x = offset_x % this.swiperWidth\n        const current_offset_i = offset_x / this.swiperWidth\n        const current_index = this.animationFinishIndex + parseInt(current_offset_i + '')\n\n        // 计算目标索引及边界检查\n        let move_to_index = current_index\n        if (current_offset_x > 0 && move_to_index < this.swiperList.length - 1) {\n          move_to_index += 1\n        } else if (current_offset_x < 0 && move_to_index > 0) {\n          move_to_index -= 1\n        }\n\n        // 计算偏移百分比\n        const percentage = Math.abs(current_offset_x) / this.swiperWidth\n\n        // 通知更新指示线\n        if (current_index != move_to_index) {\n          this.updateTabIndicator(current_index, move_to_index, percentage)\n        }\n      },\n      onSwiperAnimationfinish(e : SwiperAnimationFinishEvent) {\n        this.setSwiperIndex(e.detail.current, true)\n        this.animationFinishIndex = e.detail.current\n      },\n      setSwiperIndex(index : number, updateIndicator : boolean) {\n        if (this.swiperIndex == index) {\n          return\n        }\n\n        this.swiperIndex = index\n\n        if (updateIndicator) {\n          this.updateTabIndicator(index, index, 1)\n        }\n      },\n      updateTabIndicator(current_index : number, move_to_index : number, percentage : number) {\n        if (percentage == 0) {\n          return\n        }\n\n        // 缩放范围\n        const min_ratio = 1\n        const max_ratio = 1.3\n\n        const tabs = this.$refs['swipertab'] as UniElement[]\n        const current_node = tabs[current_index]\n        const move_to_node = tabs[move_to_index]\n\n        // 当前\n        const current_scale = lerpNumber(min_ratio, max_ratio, 1 - percentage)\n        current_node.style.setProperty('transform', `scale(${current_scale})`)\n\n        // 目标\n        const move_to_scale = lerpNumber(min_ratio, max_ratio, percentage)\n        move_to_node.style.setProperty('transform', `scale(${move_to_scale})`)\n\n        // 滚动到水平中心位置\n        const target_x = lerpNumber(current_node.offsetLeft, move_to_node.offsetLeft, percentage)\n        const center_x = target_x + move_to_node.offsetWidth / 2 - this.swiperWidth / 2\n        this.tabScrollView!.scrollLeft = center_x\n      }\n    }\n  }\n</script>\n\n<style>\n  .flex-row {\n    flex-direction: row;\n  }\n\n  .swiper-list {\n    flex: 1;\n  }\n\n  .swiper-tabs-item {\n    color: #555;\n    font-size: 16px;\n    margin: 15px 25px 5px 25px;\n    white-space: nowrap;\n  }\n\n  .swiper-tabs-item-active {\n    color: #000000;\n  }\n\n  .swiper-view {\n    flex: 1;\n  }\n\n  .swiper-item {\n    flex: 1;\n    align-items: center;\n    justify-content: center;\n  }\n\n  .swiper-item-text {\n    font-size: 72px;\n    font-weight: bold;\n  }\n</style>\n",null],"names":[],"mappings":"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"}