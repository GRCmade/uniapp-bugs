{"code":"import { defineComponent } from \"vue\";\nlet sX = 0, sY = 0, screenWidth = 1, screenHeight = 1, floating = false, touchstartAfter = false;\nexport default defineComponent({\n    data() {\n        return {\n            $elementMap: new Map(),\n            x: 0,\n            y: 0,\n            // 飘走的卡片计数\n            floatCount: 0\n        };\n    },\n    props: {\n        img: {\n            type: String,\n            default: \"/static/template/drop-card/1.jpg\"\n        },\n        cardIndex: {\n            type: Number,\n            default: 0\n        }\n    },\n    computed: {\n        movePercent() {\n            return Math.abs(this.x) / (screenWidth / 2 * 3);\n        },\n        likeOpacity() {\n            return this.x < 0 ? 0 : this.movePercent * 100;\n        },\n        dislikeOpacity() {\n            return this.x > 0 ? 0 : this.movePercent * 100;\n        }\n    },\n    mounted() {\n        uni.getSystemInfo({\n            success: (e) => {\n                screenWidth = e.screenWidth;\n                screenHeight = e.screenHeight;\n            }\n        });\n        // TODO 需要延迟设置才能生效\n        setTimeout(() => {\n            this.setElementStyle('card', 'height', screenHeight * 0.7 + 'px');\n            this.setElementStyle('card-img', 'height', screenHeight * 0.7 + 'px');\n            this.initCardStyle();\n        }, 200);\n        uni.$on('uni-drop-card-float', () => {\n            this.floatCount++;\n            this.initCardStyle();\n        });\n    },\n    methods: {\n        initCardStyle() {\n            let _index = (this.cardIndex + this.floatCount) % 3;\n            // uni.__log__('log','at pages/template/drop-card/card/card.uvue:76','~~~~~~_index:'+_index + ' cardIndex:'+this.cardIndex+' floatCount:'+this.floatCount);\n            this.setElementStyle('card', 'z-index', _index);\n            this.setElementStyle('card', 'margin-top', screenHeight * 0.15 - 30 * _index + 'px');\n            this.setElementStyle('card', 'transform', 'scale(' + (0.9 + 0.05 * _index) + ')');\n        },\n        // 工具方法，用于快速设置 Element 的 style\n        setElementStyle(refName, propertyName, propertyStyle = null) {\n            const elementMap = this.$data['$elementMap'];\n            let element = UTS.mapGet(elementMap, refName);\n            if (element == null) {\n                element = this.$refs[refName];\n                elementMap.set(refName, element);\n            }\n            else {\n                // uni.__log__('log','at pages/template/drop-card/card/card.uvue:89','直接拿');\n            }\n            element.style.setProperty(propertyName, propertyStyle);\n        },\n        touchstart(e) {\n            // uni.__log__('log','at pages/template/drop-card/card/card.uvue:94','touchstart')\n            if (floating) {\n                return null; // 浮动动画进行中\n            }\n            sX = e.touches[0].screenX;\n            sY = e.touches[0].screenY;\n            this.x = 0;\n            this.y = 0;\n            touchstartAfter = true;\n        },\n        touchmove(e) {\n            // uni.__log__('log','at pages/template/drop-card/card/card.uvue:106','touchmove')\n            if (!touchstartAfter || floating) {\n                return null; // floating：浮动动画进行中\n            }\n            this.x += e.touches[0].screenX - sX;\n            this.y += e.touches[0].screenY - sY;\n            sX = e.touches[0].screenX;\n            sY = e.touches[0].screenY;\n            this.moveCard();\n        },\n        touchend() {\n            // uni.__log__('log','at pages/template/drop-card/card/card.uvue:121','touchend')\n            touchstartAfter = false;\n            if (floating) {\n                return null; // 浮动动画进行中\n            }\n            floating = true;\n            // 设置释放之后飘走的方向 0回到坐标中心 1向右 2向左\n            let k = 0;\n            if (this.x > screenWidth / 10) {\n                k = 1;\n            }\n            else if (this.x < screenWidth * -1 / 10) {\n                k = -1;\n            }\n            const _this = this;\n            function cardTo(x, y, callback, speed = 10) {\n                let interval = 0;\n                let acceleration = 1;\n                interval = setInterval(() => {\n                    // 加速度\n                    acceleration += 0.2;\n                    const dx = x - _this.x;\n                    if (Math.abs(dx) < 1) {\n                        _this.x = x;\n                    }\n                    else {\n                        _this.x += dx / speed * acceleration;\n                    }\n                    const dy = y - _this.y;\n                    if (Math.abs(dy) < 1) {\n                        _this.y = y;\n                    }\n                    else {\n                        _this.y += dy / speed * acceleration;\n                    }\n                    _this.moveCard();\n                    if (_this.x == x && _this.y == y) {\n                        clearInterval(interval);\n                        callback();\n                    }\n                }, 16);\n            }\n            if (Math.floor(k) != 0) {\n                cardTo(k * screenWidth * 1.3, this.y * 3, () => {\n                    //  状态图标变回透明\n                    this.setElementStyle(\"state-icon-like\", 'opacity', 0);\n                    this.setElementStyle(\"state-icon-dislike\", 'opacity', 0);\n                    // 设置为透明，防止飘回时因为 margin-top 太高，露出来\n                    this.setElementStyle(\"card\", 'opacity', 0);\n                    setTimeout(() => {\n                        this.setElementStyle(\"card\", 'opacity', 1);\n                    }, 300);\n                    // 执行卡片飘动后事件，注意uni.$emit是全局事件。其他卡片也会执行\n                    uni.$emit('uni-drop-card-float', null);\n                    floating = false;\n                }, 8);\n            }\n            else {\n                const _x = this.x;\n                const _y = this.y;\n                cardTo(Math.floor(_x * -0.05), Math.floor(_y * -0.05), () => {\n                    cardTo(0, 0, () => {\n                        uni.__log__('log', 'at pages/template/drop-card/card/card.uvue:187', 'bounce');\n                        floating = false;\n                    }, 30);\n                });\n            }\n        },\n        moveCard() {\n            this.setElementStyle(\"card\", 'transform', `translate(${this.x}px,${this.y}px) rotate(${this.x / -30}deg) scale(1)`);\n            this.setElementStyle(\"state-icon-like\", 'opacity', this.x < 0 ? 0 : this.movePercent * 10);\n            this.setElementStyle(\"state-icon-dislike\", 'opacity', this.x > 0 ? 0 : this.movePercent * 10);\n        }\n    }\n});\n//# sourceMappingURL=/Users/gaoruicheng/Documents/DcloudProject/uniapp-bugs/uniapp-bugs-main/singlePage/uniapp-hello-x/pages/template/drop-card/card/card.uvue?vue&type=script&lang.uts.js.map","references":[],"uniExtApis":["uni.getSystemInfo","uni.$on","uni.$emit","uni.__log__"],"map":"{\"version\":3,\"file\":\"card.uvue?vue&type=script&lang.uts.js\",\"sourceRoot\":\"\",\"sources\":[\"card.uvue?vue&type=script&lang.uts\"],\"names\":[],\"mappings\":\"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\"}"}
