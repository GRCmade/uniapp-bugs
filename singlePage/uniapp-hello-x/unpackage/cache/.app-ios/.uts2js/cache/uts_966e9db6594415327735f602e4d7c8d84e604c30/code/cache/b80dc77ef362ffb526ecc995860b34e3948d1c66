{"code":"import { defineComponent } from \"vue\";\nexport class PayItem extends UTS.UTSType {\n    static get$UTSMetadata$() {\n        return {\n            kind: 2,\n            get fields() {\n                return {\n                    id: { type: String, optional: false },\n                    name: { type: String, optional: false },\n                    provider: { type: \"Unknown\", optional: true }\n                };\n            }\n        };\n    }\n    constructor(options, metadata = PayItem.get$UTSMetadata$(), isJSONParse = false) {\n        super();\n        this.__props__ = UTS.UTSType.initProps(options, metadata, isJSONParse);\n        this.id = this.__props__.id;\n        this.name = this.__props__.name;\n        this.provider = this.__props__.provider;\n        delete this.__props__;\n    }\n}\nexport default defineComponent({\n    data() {\n        return {\n            btnText: \"支付宝支付\",\n            btnType: \"primary\",\n            orderInfo: \"\",\n            errorCode: 0,\n            errorMsg: \"\",\n            complete: false,\n            providerList: []\n        };\n    },\n    onLoad: function () {\n        uni.getProvider({\n            service: \"payment\",\n            success: (e) => {\n                uni.__log__('log', 'at pages/API/request-payment/request-payment.uvue:28', \"payment success:\" + UTS.JSON.stringify(e));\n                let array = e.provider;\n                array.forEach((value) => {\n                    switch (value) {\n                        case 'alipay':\n                            this.providerList.push(new PayItem({\n                                name: '支付宝',\n                                id: \"alipay\",\n                                provider: UTS.arrayFind(e.providers, (item) => {\n                                    return item.id == 'alipay';\n                                })\n                            }));\n                            break;\n                        case 'wxpay':\n                            this.providerList.push(new PayItem({\n                                name: '微信',\n                                id: \"wxpay\",\n                                provider: UTS.arrayFind(e.providers, (item) => {\n                                    return item.id == 'wxpay';\n                                })\n                            }));\n                            break;\n                        default:\n                            break;\n                    }\n                });\n            },\n            fail: (e) => {\n                uni.__log__('log', 'at pages/API/request-payment/request-payment.uvue:56', \"获取支付通道失败：\", e);\n            }\n        });\n    },\n    methods: {\n        requestPayment(e) {\n            var _a;\n            const provider = e.id;\n            if (provider == \"alipay\") {\n                this.payAli();\n            }\n            else if (provider == \"wxpay\") {\n                if (e.provider != null && ((_a = e.provider) === null || _a === void 0 ? void 0 : _a.isAppExist) == false) {\n                    uni.showToast({\n                        title: \"微信没有安装\",\n                        icon: 'error'\n                    });\n                }\n                else {\n                    this.payWX();\n                }\n            }\n        },\n        payAli() {\n            uni.showLoading({\n                title: \"请求中...\"\n            });\n            uni.request({\n                url: 'https://demo.dcloud.net.cn/payment/alipay/?total=0.01',\n                method: 'GET',\n                timeout: 6000,\n                success: (res) => {\n                    this.orderInfo = UTS.JSON.stringify(res.data);\n                    uni.__log__('log', 'at pages/API/request-payment/request-payment.uvue:88', \"====\" + this.orderInfo);\n                    uni.hideLoading();\n                    uni.requestPayment({\n                        provider: \"alipay\",\n                        orderInfo: res.data,\n                        fail: (res) => {\n                            uni.__log__('log', 'at pages/API/request-payment/request-payment.uvue:94', UTS.JSON.stringify(res));\n                            this.errorCode = res.errCode;\n                            uni.showToast({\n                                icon: 'error',\n                                title: 'errorCode:' + this.errorCode\n                            });\n                        },\n                        success: (res) => {\n                            uni.__log__('log', 'at pages/API/request-payment/request-payment.uvue:102', UTS.JSON.stringify(res));\n                            uni.showToast({\n                                icon: 'success',\n                                title: '支付成功'\n                            });\n                        }\n                    });\n                },\n                fail: (e) => {\n                    uni.__log__('log', 'at pages/API/request-payment/request-payment.uvue:111', e);\n                    uni.hideLoading();\n                },\n            });\n        },\n        payWX() {\n            uni.showLoading({\n                title: \"请求中...\"\n            });\n            let url = 'https://demo.dcloud.net.cn/payment/wxpayv3.__UNI__uniappx/?total=0.01';\n            const res = uni.getAppBaseInfo();\n            let packageName = null;\n            packageName = res.bundleId;\n            if (packageName == 'io.dcloud.hellouniappx') { //hello uniappx\n                url = 'https://demo.dcloud.net.cn/payment/wxpayv3.__UNI__HelloUniAppX/?total=0.01';\n            }\n            uni.request({\n                url: url,\n                method: 'GET',\n                timeout: 6000,\n                header: new UTSJSONObject({\n                    \"Content-Type\": \"application/json\"\n                }),\n                success: (res) => {\n                    uni.__log__('log', 'at pages/API/request-payment/request-payment.uvue:143', res.data);\n                    uni.hideLoading();\n                    uni.requestPayment({\n                        provider: \"wxpay\",\n                        orderInfo: UTS.JSON.stringify(res.data),\n                        fail: (res) => {\n                            uni.__log__('log', 'at pages/API/request-payment/request-payment.uvue:149', UTS.JSON.stringify(res));\n                            this.errorCode = res.errCode;\n                            uni.showToast({\n                                duration: 5000,\n                                icon: 'error',\n                                title: 'errorCode:' + this.errorCode,\n                            });\n                        },\n                        success: (res) => {\n                            uni.__log__('log', 'at pages/API/request-payment/request-payment.uvue:158', UTS.JSON.stringify(res));\n                            uni.showToast({\n                                duration: 5000,\n                                icon: 'success',\n                                title: '支付成功'\n                            });\n                        }\n                    });\n                },\n                fail: (res) => {\n                    uni.hideLoading();\n                    uni.__log__('log', 'at pages/API/request-payment/request-payment.uvue:169', res);\n                },\n            });\n        },\n        //自动化测试使用\n        jest_pay() {\n            uni.requestPayment({\n                provider: \"alipay\",\n                orderInfo: this.orderInfo,\n                fail: (res) => {\n                    this.errorCode = res.errCode;\n                    this.complete = true;\n                },\n                success: (res) => {\n                    uni.__log__('log', 'at pages/API/request-payment/request-payment.uvue:184', UTS.JSON.stringify(res));\n                    this.complete = true;\n                }\n            });\n        }\n    }\n});\n//# sourceMappingURL=/Users/gaoruicheng/Documents/DcloudProject/uniapp-bugs/uniapp-bugs-main/singlePage/uniapp-hello-x/pages/API/request-payment/request-payment.uvue?vue&type=script&lang.uts.js.map","references":[],"uniExtApis":["uni.getProvider","uni.__log__","uni.showToast","uni.showLoading","uni.request","uni.hideLoading","uni.requestPayment","uni.getAppBaseInfo"],"map":"{\"version\":3,\"file\":\"request-payment.uvue?vue&type=script&lang.uts.js\",\"sourceRoot\":\"\",\"sources\":[\"request-payment.uvue?vue&type=script&lang.uts\"],\"names\":[],\"mappings\":\"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\"}"}
