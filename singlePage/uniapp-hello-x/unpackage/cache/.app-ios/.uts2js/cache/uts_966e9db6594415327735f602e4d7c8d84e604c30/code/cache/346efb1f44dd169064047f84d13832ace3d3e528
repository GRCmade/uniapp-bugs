{"code":"import { defineComponent } from \"vue\";\nclass ListItem extends UTS.UTSType {\n    static get$UTSMetadata$() {\n        return {\n            kind: 2,\n            get fields() {\n                return {\n                    _id: { type: String, optional: false },\n                    content: { type: String, optional: false },\n                    src: { type: String, optional: false },\n                    poster_src: { type: String, optional: false }\n                };\n            }\n        };\n    }\n    constructor(options, metadata = ListItem.get$UTSMetadata$(), isJSONParse = false) {\n        super();\n        this.__props__ = UTS.UTSType.initProps(options, metadata, isJSONParse);\n        this._id = this.__props__._id;\n        this.content = this.__props__.content;\n        this.src = this.__props__.src;\n        this.poster_src = this.__props__.poster_src;\n        delete this.__props__;\n    }\n}\nlet page = 0, currentPageIsShow = true;\nexport default defineComponent({\n    components: {},\n    data() {\n        return {\n            $videoContextMap: new Map(),\n            list: [],\n            visibleList: [],\n            current: 0,\n            index: 0,\n            state: [\"unPlay\", \"unPlay\", \"unPlay\"]\n        };\n    },\n    created() {\n        this.list = this.getData();\n        this.visibleList = this.list.slice(0, 3);\n    },\n    watch: {\n        current(current, oldCurrent) {\n            let changeNumber = current - oldCurrent;\n            if (changeNumber == 1 || changeNumber == -2) {\n                // uni.__log__('error','at pages/template/swiper-vertical-video/swiper-vertical-video.uvue:53','向右');\n                this.index++;\n            }\n            else {\n                // uni.__log__('error','at pages/template/swiper-vertical-video/swiper-vertical-video.uvue:56','向左');\n                this.index--;\n            }\n            // //翻页（3项为一页）\n            if (Math.abs(changeNumber) == 2) {\n                // uni.__log__('log','at pages/template/swiper-vertical-video/swiper-vertical-video.uvue:61','翻页');\n                page = Math.floor(this.index / 3);\n                // uni.__log__('log','at pages/template/swiper-vertical-video/swiper-vertical-video.uvue:63',this.index);\n                // uni.__log__('log','at pages/template/swiper-vertical-video/swiper-vertical-video.uvue:64','page',page);\n                // uni.__log__('log','at pages/template/swiper-vertical-video/swiper-vertical-video.uvue:65','slice',3*page,3*page+3);\n                if (this.list.length < 3 * page + 3) {\n                    let list = this.getData();\n                    this.list.push(...list);\n                }\n                let visibleList = this.list.slice(3 * page, 3 * page + 3);\n                // 换数据\n                this.visibleList = visibleList;\n            }\n            this.state.forEach((_, index) => {\n                if (index === current) {\n                    this.doPlay(current);\n                }\n                else {\n                    // 除了选中的其他已经播放的都需要停止\n                    this.doStop(index);\n                    uni.__log__('log', 'at pages/template/swiper-vertical-video/swiper-vertical-video.uvue:82', 'index:' + index + '已被执行停止');\n                }\n            });\n        }\n    },\n    onReady() {\n        // 一启动完成，就播放第一个\n        this.doPlay(0);\n        //App端适配不同状态栏高度\n        let backElement = this.$refs['back'];\n        backElement.style.setProperty('top', uni.getSystemInfoSync().statusBarHeight + 'px');\n    },\n    onShow() {\n        currentPageIsShow = true;\n    },\n    onHide() {\n        currentPageIsShow = false;\n        uni.__log__('log', 'at pages/template/swiper-vertical-video/swiper-vertical-video.uvue:101', 'pages-onHide');\n        this.doPause(this.current);\n    },\n    onUnload() {\n        this.doPause(this.current);\n    },\n    methods: {\n        changeState(index) {\n            if (this.state[index] === 'play') {\n                this.doPause(index);\n            }\n            else {\n                this.doPlay(this.current);\n            }\n        },\n        onLoadstart(index) {\n            uni.__log__('error', 'at pages/template/swiper-vertical-video/swiper-vertical-video.uvue:116', \"onLoadstart  video\" + index);\n        },\n        getVideoContext(index) {\n            const videoContextMap = this.$data['$videoContextMap'];\n            let videoContext = UTS.mapGet(videoContextMap, 'video-' + index);\n            if (videoContext == null) {\n                videoContext = uni.createVideoContext('video-' + index, this);\n                videoContextMap.set('video-' + index, videoContext);\n            }\n            return videoContext;\n        },\n        doPlay(index) {\n            uni.__log__('log', 'at pages/template/swiper-vertical-video/swiper-vertical-video.uvue:128', \"doPlay  video\" + index);\n            this.getVideoContext(index).play();\n        },\n        doStop(index) {\n            uni.__log__('log', 'at pages/template/swiper-vertical-video/swiper-vertical-video.uvue:132', \"doStop  video-\" + index);\n            this.getVideoContext(index).stop();\n            // TODO 临时方案：解决.stop()时触发了doPause的问题\n            setTimeout(() => {\n                this.state[index] = 'unPlay';\n            }, 1000);\n        },\n        doPause(index) {\n            this.getVideoContext(index).pause();\n            uni.__log__('log', 'at pages/template/swiper-vertical-video/swiper-vertical-video.uvue:141', \"doPause  video-\" + index);\n        },\n        onPause(index) {\n            this.state[index] = 'pause';\n            uni.__log__('log', 'at pages/template/swiper-vertical-video/swiper-vertical-video.uvue:145', 'onPause', index);\n        },\n        onPlay(index) {\n            if (this.current != index || !currentPageIsShow) {\n                this.onPause(index);\n            }\n            else {\n                this.state[index] = 'play';\n                uni.__log__('log', 'at pages/template/swiper-vertical-video/swiper-vertical-video.uvue:152', 'onPlay', index);\n            }\n        },\n        getData() {\n            let videoUrlList = [\n                'https://web-ext-storage.dcloud.net.cn/uni-app-x/video/uts-5-16.mp4',\n                'https://web-ext-storage.dcloud.net.cn/uni-app-x/video/uni-ai-5-16.mp4',\n                'https://web-ext-storage.dcloud.net.cn/uni-app-x/video/uni-verify-5-16.mp4'\n            ];\n            let posterSrcList = [\n                'https://web-ext-storage.dcloud.net.cn/uni-app-x/dark-uni-uts-01.png',\n                'https://web-ext-storage.dcloud.net.cn/uni-app-x/dark-uni-ai-01.png',\n                'https://web-ext-storage.dcloud.net.cn/uni-app-x/dark-uni-verify-01.jpg'\n            ];\n            let list = [];\n            for (let i = 0; i < 6; i++) {\n                let index = this.list.length + i;\n                let listItem = new ListItem({\n                    \"_id\": \"a00\" + index,\n                    \"content\": \"这是第\" + index + \"条数据，url地址\" + videoUrlList[i % 3],\n                    \"src\": videoUrlList[i % 3],\n                    \"poster_src\": posterSrcList[i % 3]\n                });\n                list.push(listItem);\n            }\n            return list;\n        },\n        onSwiperChange(e) {\n            // uni.__log__('error','at pages/template/swiper-vertical-video/swiper-vertical-video.uvue:182','SwiperChangeEvent',e.detail.current);\n            this.current = e.detail.current;\n        },\n        onTransition( /*e : SwiperTransitionEvent*/) {\n            // uni.__log__('log','at pages/template/swiper-vertical-video/swiper-vertical-video.uvue:186','onTransition e.detail.dx', e.detail.dx);\n        },\n        back() {\n            uni.navigateBack({\n                success(result = null) {\n                    uni.__log__('log', 'at pages/template/swiper-vertical-video/swiper-vertical-video.uvue:191', 'navigateBack success', result.errMsg);\n                },\n                fail(error) {\n                    uni.__log__('log', 'at pages/template/swiper-vertical-video/swiper-vertical-video.uvue:194', 'navigateBack fail', error.errMsg);\n                },\n                complete(result) {\n                    uni.__log__('log', 'at pages/template/swiper-vertical-video/swiper-vertical-video.uvue:197', 'navigateBack complete', result.errMsg);\n                }\n            });\n        }\n    }\n});\n//# sourceMappingURL=/Users/gaoruicheng/Documents/DcloudProject/uniapp-bugs/uniapp-bugs-main/singlePage/uniapp-hello-x/pages/template/swiper-vertical-video/swiper-vertical-video.uvue?vue&type=script&lang.uts.js.map","references":[],"uniExtApis":["uni.__log__","uni.getSystemInfoSync","uni.createVideoContext","uni.navigateBack"],"map":"{\"version\":3,\"file\":\"swiper-vertical-video.uvue?vue&type=script&lang.uts.js\",\"sourceRoot\":\"\",\"sources\":[\"swiper-vertical-video.uvue?vue&type=script&lang.uts\"],\"names\":[],\"mappings\":\"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\"}"}
