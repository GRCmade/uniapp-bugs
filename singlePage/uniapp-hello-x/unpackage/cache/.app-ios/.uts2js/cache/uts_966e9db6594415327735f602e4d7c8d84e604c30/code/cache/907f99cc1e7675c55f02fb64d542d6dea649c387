{"code":"import { __awaiter } from \"tslib\";\nimport callCheckVersion, {} from \"./call-check-version\";\nimport { openSchema } from '@/uni_modules/uts-openSchema';\n// 推荐再App.vue中使用\nconst PACKAGE_INFO_KEY = '__package_info__';\n// uni-app 项目无法从 vue 中导出 ComponentPublicInstance 类型，故使用条件编译\nexport default function (component = null) {\n    return new Promise((resolve, reject) => {\n        callCheckVersion().then((uniUpgradeCenterResult) => { return __awaiter(this, void 0, void 0, function* () {\n            // NOTE uni-app x 3.96 解构有问题\n            const code = uniUpgradeCenterResult.code;\n            const message = uniUpgradeCenterResult.message;\n            const url = uniUpgradeCenterResult.url; // 安装包下载地址\n            // 此处逻辑仅为示例，可自行编写\n            if (code > 0) {\n                // 腾讯云和阿里云下载链接不同，需要处理一下，阿里云会原样返回\n                const tcbRes = yield uniCloud.getTempFileURL({ fileList: [url] });\n                if (typeof tcbRes.fileList[0].tempFileURL !== 'undefined')\n                    uniUpgradeCenterResult.url = tcbRes.fileList[0].tempFileURL;\n                /**\n                 * 提示升级一\n                 * 使用 uni.showModal\n                 */\n                // return updateUseModal(uniUpgradeCenterResult)\n                /**\n                 * 提示升级二\n                 * 官方适配的升级弹窗，可自行替换资源适配UI风格\n                 */\n                component === null || component === void 0 ? void 0 : component.$callMethod('show', true, uniUpgradeCenterResult);\n                return resolve(uniUpgradeCenterResult);\n            }\n            else if (code < 0) {\n                uni.__log__('error', 'at uni_modules/uni-upgrade-center-app/utils/check-update.ts:73', message);\n                return reject(uniUpgradeCenterResult);\n            }\n            return resolve(uniUpgradeCenterResult);\n        }); }).catch((err) => {\n            reject(err);\n        });\n    });\n}\n/**\n * 使用 uni.showModal 升级\n */\nfunction updateUseModal(packageInfo) {\n    const title = packageInfo.title, // 标题\n    contents = packageInfo.contents, // 升级内容\n    is_mandatory = packageInfo.is_mandatory, // 是否强制更新\n    url = packageInfo.url, // 安装包下载地址\n    type = packageInfo.type, platform = packageInfo.platform;\n    let isWGT = type === 'wgt';\n    let isiOS = !isWGT ? platform.includes('iOS') : false;\n    let confirmText = '立即下载更新';\n    return uni.showModal({\n        title,\n        content: contents,\n        showCancel: !is_mandatory,\n        confirmText,\n        success: res => {\n            if (res.cancel)\n                return;\n            if (isiOS) {\n                // iOS 平台跳转 AppStore\n                openSchema(url);\n                return;\n            }\n            uni.showToast({\n                title: '后台下载中……',\n                duration: 1000\n            });\n            // wgt 和 安卓下载更新\n            uni.downloadFile({\n                url,\n                success: res => {\n                    if (res.statusCode !== 200) {\n                        uni.__log__('error', 'at uni_modules/uni-upgrade-center-app/utils/check-update.ts:136', '下载安装包失败');\n                        return;\n                    }\n                    // 下载好直接安装，下次启动生效\n                    // uni-app x 项目没有 plus5+ 故使用条件编译\n                    uni.installApk({\n                        filePath: res.tempFilePath,\n                        success: () => {\n                            uni.showModal({\n                                title: '安装成功请手动重启'\n                            });\n                        },\n                        fail: err => {\n                            uni.showModal({\n                                title: '更新失败',\n                                content: err.message,\n                                showCancel: false\n                            });\n                        }\n                    });\n                }\n            });\n        }\n    });\n}\n//# sourceMappingURL=/Users/gaoruicheng/Documents/DcloudProject/uniapp-bugs/uniapp-bugs-main/singlePage/uniapp-hello-x/uni_modules/uni-upgrade-center-app/utils/check-update.js.map","references":["/Users/gaoruicheng/Documents/DcloudProject/uniapp-bugs/uniapp-bugs-main/singlePage/uniapp-hello-x/uni_modules/uni-upgrade-center-app/utils/call-check-version.ts"],"uniExtApis":[],"map":"{\"version\":3,\"file\":\"check-update.js\",\"sourceRoot\":\"\",\"sources\":[\"check-update.ts\"],\"names\":[],\"mappings\":\"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\"}"}
