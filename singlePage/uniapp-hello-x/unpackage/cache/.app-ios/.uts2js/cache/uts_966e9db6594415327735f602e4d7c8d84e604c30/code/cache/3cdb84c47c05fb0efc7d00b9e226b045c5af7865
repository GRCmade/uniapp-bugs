{"code":"import { defineComponent } from \"vue\";\nimport longPage from './long-list-page.uvue';\nclass SwiperTabsItem extends UTS.UTSType {\n    static get$UTSMetadata$() {\n        return {\n            kind: 2,\n            get fields() {\n                return {\n                    x: { type: Number, optional: false },\n                    w: { type: Number, optional: false }\n                };\n            }\n        };\n    }\n    constructor(options, metadata = SwiperTabsItem.get$UTSMetadata$(), isJSONParse = false) {\n        super();\n        this.__props__ = UTS.UTSType.initProps(options, metadata, isJSONParse);\n        this.x = this.__props__.x;\n        this.w = this.__props__.w;\n        delete this.__props__;\n    }\n}\nclass SwiperViewItem extends UTS.UTSType {\n    static get$UTSMetadata$() {\n        return {\n            kind: 2,\n            get fields() {\n                return {\n                    type: { type: String, optional: false },\n                    name: { type: String, optional: false },\n                    preload: { type: Boolean, optional: false }\n                };\n            }\n        };\n    }\n    constructor(options, metadata = SwiperViewItem.get$UTSMetadata$(), isJSONParse = false) {\n        super();\n        this.__props__ = UTS.UTSType.initProps(options, metadata, isJSONParse);\n        this.type = this.__props__.type;\n        this.name = this.__props__.name;\n        this.preload = this.__props__.preload;\n        delete this.__props__;\n    }\n}\n/**\n * 根据权重在两个值之间执行线性插值.\n * @constructor\n * @param {number} value1 - 第一个值，该值应为下限.\n * @param {number} value2 - 第二个值，该值应为上限.\n * @param {number} amount - 应介于 0 和 1 之间，指示内插的权重.\n * @returns {number} 内插值\n */\nfunction lerpNumber(value1, value2, amount) {\n    return (value1 + (value2 - value1) * amount);\n}\nexport default defineComponent({\n    components: {\n        longPage\n    },\n    data() {\n        return {\n            swiperList: [\n                new SwiperViewItem({\n                    type: 'UpdatedDate',\n                    name: '最新上架',\n                    preload: true\n                }),\n                new SwiperViewItem({\n                    type: 'FreeHot',\n                    name: '免费热榜',\n                    preload: false\n                }),\n                new SwiperViewItem({\n                    type: 'PaymentHot',\n                    name: '付费热榜',\n                    preload: false\n                }),\n                new SwiperViewItem({\n                    type: 'HotList',\n                    name: '热门总榜',\n                    preload: false\n                })\n            ],\n            swiperIndex: 0,\n            pageScrollView: null,\n            headerHeight: 0,\n            animationFinishIndex: 0,\n            tabScrollView: null,\n            indicatorNode: null,\n            swiperWidth: 0,\n            swiperTabsRect: []\n        };\n    },\n    onReady() {\n        this.pageScrollView = this.$refs['pageScrollView'];\n        this.headerHeight = this.$refs['header'].offsetHeight;\n        this.swiperWidth = this.$refs['swiper'].getBoundingClientRect().width;\n        this.tabScrollView = this.$refs['tabScroll'];\n        this.indicatorNode = this.$refs['indicator'];\n        this.cacheTabItemsSize();\n        this.updateTabIndicator(this.swiperIndex, this.swiperIndex, 1);\n    },\n    onPullDownRefresh() {\n        this.$refs[\"longPage\"][this.swiperIndex].$callMethod('refreshData', () => {\n            uni.stopPullDownRefresh();\n        });\n    },\n    methods: {\n        // TODO\n        onStartNestedScroll(_) {\n            return true;\n        },\n        onNestedPreScroll(event) {\n            const deltaY = event.deltaY;\n            const scrollTop = this.pageScrollView.scrollTop;\n            // 优先处理父容器滚动，父容器不能滚动时滚动子\n            if (deltaY > 0) {\n                // 向上滚动，如果父容器 header scrollTop < offsetHeight，先滚动父容器\n                if (scrollTop < this.headerHeight) {\n                    const difference = this.headerHeight - scrollTop - deltaY;\n                    if (difference > 0) {\n                        this.pageScrollView.scrollBy(event.deltaX, deltaY);\n                        event.consumed(event.deltaX, deltaY);\n                    }\n                    else {\n                        const top_1 = deltaY + difference;\n                        event.consumed(event.deltaX, top_1.toFloat());\n                        this.pageScrollView.scrollBy(event.deltaX, top_1.toFloat());\n                    }\n                }\n            }\n            else if (deltaY < 0) {\n                // 向下滚动，如果父容器 scrollTop > 0，通知子被父容器消耗，然后滚动到 0\n                if (scrollTop > 0) {\n                    event.consumed(event.deltaX, deltaY);\n                    this.pageScrollView.scrollBy(event.deltaX, deltaY);\n                }\n            }\n        },\n        onTabClick(index) {\n            this.setSwiperIndex(index, false);\n        },\n        onSwiperTransition(e) {\n            // 微信 skyline 每项完成触发 Animationfinish，偏移值重置\n            // 微信 webview 全部完成触发 Animationfinish，偏移值累加\n            // 在滑动到下一个项的过程中，再次反向滑动，偏移值递减\n            // uni-app-x 和微信 webview 行为一致\n            const offset_x = e.detail.dx;\n            // 计算当前索引并重置差异\n            const current_offset_x = offset_x % this.swiperWidth;\n            const current_offset_i = offset_x / this.swiperWidth;\n            const current_index = this.animationFinishIndex + parseInt(current_offset_i + '');\n            // 计算目标索引及边界检查\n            let move_to_index = current_index;\n            if (current_offset_x > 0 && move_to_index < this.swiperList.length - 1) {\n                move_to_index += 1;\n            }\n            else if (current_offset_x < 0 && move_to_index > 0) {\n                move_to_index -= 1;\n            }\n            // 计算偏移百分比\n            const percentage = Math.abs(current_offset_x) / this.swiperWidth;\n            // 通知更新指示线\n            this.updateTabIndicator(current_index, move_to_index, percentage);\n            // 首次可见时初始化数据\n            this.initSwiperItemData(move_to_index);\n        },\n        onSwiperAnimationfinish(e) {\n            this.setSwiperIndex(e.detail.current, true);\n            this.animationFinishIndex = e.detail.current;\n            uni.__log__('log', 'at pages/template/long-list/long-list.uvue:173', 'this.animationFinishIndex', e.detail.current);\n        },\n        cacheTabItemsSize() {\n            this.swiperTabsRect.length = 0;\n            const tabs = this.$refs[\"swipertab\"];\n            tabs.forEach((node) => {\n                this.swiperTabsRect.push(new SwiperTabsItem({\n                    x: node.offsetLeft,\n                    w: node.offsetWidth\n                }));\n            });\n        },\n        setSwiperIndex(index, updateIndicator) {\n            if (this.swiperIndex === index) {\n                return null;\n            }\n            this.swiperIndex = index;\n            this.initSwiperItemData(index);\n            if (updateIndicator) {\n                this.updateTabIndicator(index, index, 1);\n            }\n        },\n        updateTabIndicator(current_index, move_to_index, percentage) {\n            var _a, _b;\n            const current_size = this.swiperTabsRect[current_index];\n            const move_to_size = this.swiperTabsRect[move_to_index];\n            // 计算指示线 左边距 和 宽度 在移动过程中的线性值\n            const indicator_line_x = lerpNumber(current_size.x, move_to_size.x, percentage);\n            const indicator_line_w = lerpNumber(current_size.w, move_to_size.w, percentage);\n            // 更新指示线\n            const x = indicator_line_x + indicator_line_w / 2;\n            (_b = (_a = this.indicatorNode) === null || _a === void 0 ? void 0 : _a.style) === null || _b === void 0 ? void 0 : _b.setProperty('transform', `translateX(${x}px) scaleX(${indicator_line_w})`);\n            // 滚动到水平中心位置\n            const scroll_x = x - this.swiperWidth / 2;\n            if (this.tabScrollView != null) {\n                this.tabScrollView.scrollLeft = scroll_x;\n            }\n        },\n        initSwiperItemData(index) {\n            if (!this.swiperList[index].preload) {\n                this.swiperList[index].preload = true;\n                this.$refs[\"longPage\"][index].$callMethod('loadData', null);\n            }\n        }\n    }\n});\n//# sourceMappingURL=/Users/gaoruicheng/Documents/DcloudProject/uniapp-bugs/uniapp-bugs-main/singlePage/uniapp-hello-x/pages/template/long-list/long-list.uvue?vue&type=script&lang.uts.js.map","references":["/Users/gaoruicheng/Documents/DcloudProject/uniapp-bugs/uniapp-bugs-main/singlePage/uniapp-hello-x/pages/template/long-list/long-list-page.uvue.ts"],"uniExtApis":["uni.stopPullDownRefresh","uni.__log__"],"map":"{\"version\":3,\"file\":\"long-list.uvue?vue&type=script&lang.uts.js\",\"sourceRoot\":\"\",\"sources\":[\"long-list.uvue?vue&type=script&lang.uts\"],\"names\":[],\"mappings\":\"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\"}"}
