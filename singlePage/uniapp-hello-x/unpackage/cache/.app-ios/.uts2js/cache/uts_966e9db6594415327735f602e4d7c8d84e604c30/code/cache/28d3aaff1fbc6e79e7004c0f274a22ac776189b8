{"code":"import { defineComponent } from \"vue\";\nexport default defineComponent({\n    data() {\n        return {\n            title: '一键登录',\n            univerifyManager: null\n        };\n    },\n    onLoad() {\n        var _a;\n        this.univerifyManager = uni.getUniverifyManager();\n        // 预登录\n        (_a = this.univerifyManager) === null || _a === void 0 ? void 0 : _a.preLogin({\n            success: () => {\n                uni.__log__('log', 'at pages/API/get-univerify-manager/get-univerify-manager.uvue:28', \"pre login success\");\n            },\n            fail: (err) => {\n                uni.__log__('error', 'at pages/API/get-univerify-manager/get-univerify-manager.uvue:31', \"pre login fail => \" + UTS.JSON.stringify(err));\n                uni.showToast({\n                    title: '预登录失败'\n                });\n            }\n        });\n    },\n    methods: {\n        verify(fullScreen) {\n            var _a, _b, _c;\n            // 校验预登录是否有效\n            const isPreLoginValid = (_b = (_a = this.univerifyManager) === null || _a === void 0 ? void 0 : _a.isPreLoginValid()) !== null && _b !== void 0 ? _b : false;\n            if (isPreLoginValid) {\n                // 预登录有效，执行登录\n                this.login(fullScreen);\n            }\n            else {\n                // 预登录无效，执行预登录\n                (_c = this.univerifyManager) === null || _c === void 0 ? void 0 : _c.preLogin({\n                    success: () => {\n                        uni.__log__('log', 'at pages/API/get-univerify-manager/get-univerify-manager.uvue:49', \"pre login success\");\n                        this.login(fullScreen);\n                    },\n                    fail: (err) => {\n                        uni.__log__('error', 'at pages/API/get-univerify-manager/get-univerify-manager.uvue:53', \"pre login fail => \" + UTS.JSON.stringify(err));\n                        uni.showToast({\n                            title: '预登录失败'\n                        });\n                    }\n                });\n            }\n        },\n        login(fullScreen) {\n            var _a;\n            (_a = this.univerifyManager) === null || _a === void 0 ? void 0 : _a.login({\n                // 登录页样式\n                univerifyStyle: {\n                    fullScreen: fullScreen,\n                    backgroundColor: \"#FFFFFF\",\n                    loginBtnText: \"一键登录\",\n                    logoPath: \"/static/logo.png\"\n                },\n                success: (res) => {\n                    uni.__log__('log', 'at pages/API/get-univerify-manager/get-univerify-manager.uvue:71', \"login success => \" + UTS.JSON.stringify(res));\n                    // 云函数取号\n                    uniCloud.callFunction({\n                        name: 'univerify',\n                        data: new UTSJSONObject({\n                            access_token: res.accessToken,\n                            openid: res.openId // 客户端一键登录接口返回的openid\n                        })\n                    }).then(res => {\n                        var _a;\n                        // 关闭登录页\n                        (_a = this.univerifyManager) === null || _a === void 0 ? void 0 : _a.close();\n                        setTimeout(() => {\n                            var _a;\n                            uni.showModal({\n                                title: '取号成功',\n                                content: (_a = res.result.getJSON(\"res\")) === null || _a === void 0 ? void 0 : _a.getString(\"phoneNumber\"),\n                                showCancel: false\n                            });\n                        }, 100);\n                    }).catch((err = null) => {\n                        var _a;\n                        uni.__log__('error', 'at pages/API/get-univerify-manager/get-univerify-manager.uvue:90', UTS.JSON.stringify(err));\n                        // 关闭登录页\n                        (_a = this.univerifyManager) === null || _a === void 0 ? void 0 : _a.close();\n                        setTimeout(() => {\n                            uni.showModal({\n                                title: '取号失败',\n                                content: err.message,\n                                showCancel: false\n                            });\n                        }, 100);\n                    });\n                },\n                fail: (err) => {\n                    uni.__log__('error', 'at pages/API/get-univerify-manager/get-univerify-manager.uvue:103', \"login fail => \" + err);\n                    uni.showToast({\n                        title: '登录失败'\n                    });\n                }\n            });\n        }\n    }\n});\n//# sourceMappingURL=/Users/gaoruicheng/Documents/DcloudProject/uniapp-bugs/uniapp-bugs-main/singlePage/uniapp-hello-x/pages/API/get-univerify-manager/get-univerify-manager.uvue?vue&type=script&lang.uts.js.map","references":[],"uniExtApis":["uni.getUniverifyManager","uni.__log__","uni.showToast","uniCloud.callFunction","uni.showModal"],"map":"{\"version\":3,\"file\":\"get-univerify-manager.uvue?vue&type=script&lang.uts.js\",\"sourceRoot\":\"\",\"sources\":[\"get-univerify-manager.uvue?vue&type=script&lang.uts\"],\"names\":[],\"mappings\":\"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\"}"}
