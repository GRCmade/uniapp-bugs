{"code":"import { defineComponent } from \"vue\";\nexport default defineComponent({\n    data() {\n        return {\n            connected: false,\n            connecting: false,\n            socketTask: null,\n            msg: '',\n            platform: '',\n            //自动化测试例专用\n            jest_result: 0,\n        };\n    },\n    computed: {\n        showMsg() {\n            if (this.connected) {\n                if (this.msg.length > 0) {\n                    return '收到消息：' + this.msg;\n                }\n                else {\n                    return '等待接收消息';\n                }\n            }\n            else {\n                return '尚未连接';\n            }\n        },\n    },\n    onLoad() {\n        this.platform = uni.getSystemInfoSync().platform;\n    },\n    onUnload() {\n        uni.hideLoading();\n        let task = this.socketTask;\n        if (task != null) {\n            task.close({\n                code: 1000,\n                reason: 'close reason from client',\n                success: (res = null) => {\n                    uni.__log__('log', 'at pages/API/websocket-socketTask/websocket-socketTask.uvue:57', 'uni.closeSocket success', res);\n                },\n                fail: (err = null) => {\n                    uni.__log__('log', 'at pages/API/websocket-socketTask/websocket-socketTask.uvue:60', 'uni.closeSocket fail', err);\n                },\n            });\n        }\n    },\n    methods: {\n        connect() {\n            var _a, _b, _c, _d;\n            if (this.connected || this.connecting) {\n                uni.showModal({\n                    content: '正在连接或者已经连接，请勿重复连接',\n                    showCancel: false,\n                });\n                return null;\n            }\n            this.connecting = true;\n            uni.showLoading({\n                title: '连接中...',\n            });\n            this.socketTask = uni.connectSocket({\n                url: 'ws://websocket.dcloud.net.cn',\n                success: (res = null) => {\n                    // 这里是接口调用成功的回调，不是连接成功的回调，请注意\n                    uni.__log__('log', 'at pages/API/websocket-socketTask/websocket-socketTask.uvue:82', 'uni.connectSocket success', res);\n                },\n                fail: (err = null) => {\n                    // 这里是接口调用失败的回调，不是连接失败的回调，请注意\n                    uni.__log__('log', 'at pages/API/websocket-socketTask/websocket-socketTask.uvue:86', 'uni.connectSocket fail', err);\n                },\n            });\n            (_a = this.socketTask) === null || _a === void 0 ? void 0 : _a.onOpen((res = null) => {\n                this.connecting = false;\n                this.connected = true;\n                uni.hideLoading();\n                uni.showToast({\n                    icon: 'none',\n                    title: '连接成功',\n                });\n                uni.__log__('log', 'at pages/API/websocket-socketTask/websocket-socketTask.uvue:97', 'onOpen', res);\n            });\n            (_b = this.socketTask) === null || _b === void 0 ? void 0 : _b.onError((err = null) => {\n                this.connecting = false;\n                this.connected = false;\n                uni.hideLoading();\n                uni.showModal({\n                    content: '连接失败，可能是websocket服务不可用，请稍后再试',\n                    showCancel: false,\n                });\n                uni.__log__('log', 'at pages/API/websocket-socketTask/websocket-socketTask.uvue:107', 'onError', err);\n            });\n            (_c = this.socketTask) === null || _c === void 0 ? void 0 : _c.onMessage((res) => {\n                this.msg = res.data;\n                uni.__log__('log', 'at pages/API/websocket-socketTask/websocket-socketTask.uvue:111', 'onMessage', res);\n            });\n            (_d = this.socketTask) === null || _d === void 0 ? void 0 : _d.onClose((res = null) => {\n                this.connected = false;\n                this.socketTask = null;\n                this.msg = '';\n                uni.__log__('log', 'at pages/API/websocket-socketTask/websocket-socketTask.uvue:117', 'onClose', res);\n            });\n        },\n        send() {\n            var _a;\n            const data = 'from ' +\n                this.platform +\n                ' : ' +\n                parseInt(Math.random() * 10000 + '').toString();\n            (_a = this.socketTask) === null || _a === void 0 ? void 0 : _a.send({\n                data,\n                success: (res = null) => {\n                    uni.__log__('log', 'at pages/API/websocket-socketTask/websocket-socketTask.uvue:129', res);\n                },\n                fail: (err = null) => {\n                    uni.__log__('log', 'at pages/API/websocket-socketTask/websocket-socketTask.uvue:132', err);\n                },\n            });\n        },\n        close() {\n            var _a;\n            (_a = this.socketTask) === null || _a === void 0 ? void 0 : _a.close({\n                code: 1000,\n                reason: 'close reason from client',\n                success: (res = null) => {\n                    uni.__log__('log', 'at pages/API/websocket-socketTask/websocket-socketTask.uvue:141', 'uni.closeSocket success', res);\n                },\n                fail: (err = null) => {\n                    uni.__log__('log', 'at pages/API/websocket-socketTask/websocket-socketTask.uvue:144', 'uni.closeSocket fail', err);\n                },\n            });\n        },\n        //自动化测试例专用\n        jest_connectSocket() {\n            var _a, _b;\n            this.socketTask = uni.connectSocket({\n                url: 'ws://websocket.dcloud.net.cn',\n                success: (_) => {\n                    this.jest_result++;\n                },\n                fail: (_) => {\n                    this.jest_result = 0;\n                },\n            });\n            (_a = this.socketTask) === null || _a === void 0 ? void 0 : _a.onOpen((_) => {\n                var _a;\n                const data = 'from ' +\n                    this.platform +\n                    ' : ' +\n                    parseInt(Math.random() * 10000 + '').toString();\n                (_a = this.socketTask) === null || _a === void 0 ? void 0 : _a.send({\n                    data,\n                    success: (_) => {\n                        this.jest_result++;\n                    },\n                    fail: (_) => {\n                        this.jest_result = 0;\n                    },\n                });\n            });\n            (_b = this.socketTask) === null || _b === void 0 ? void 0 : _b.onError((_) => {\n                this.jest_result = 0;\n            });\n        }\n    },\n});\n//# sourceMappingURL=/Users/gaoruicheng/Documents/DcloudProject/uniapp-bugs/uniapp-bugs-main/singlePage/uniapp-hello-x/pages/API/websocket-socketTask/websocket-socketTask.uvue?vue&type=script&lang.uts.js.map","references":[],"uniExtApis":["uni.getSystemInfoSync","uni.hideLoading","uni.__log__","uni.showModal","uni.showLoading","uni.connectSocket","uni.showToast"],"map":"{\"version\":3,\"file\":\"websocket-socketTask.uvue?vue&type=script&lang.uts.js\",\"sourceRoot\":\"\",\"sources\":[\"websocket-socketTask.uvue?vue&type=script&lang.uts\"],\"names\":[],\"mappings\":\"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\"}"}
