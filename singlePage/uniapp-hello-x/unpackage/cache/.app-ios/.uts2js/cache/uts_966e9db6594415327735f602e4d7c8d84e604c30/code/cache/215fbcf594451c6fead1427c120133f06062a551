{"code":"import { defineComponent } from \"vue\";\nimport { testInovkeUploadFile } from '@/uni_modules/test-invoke-network-api';\nexport default defineComponent({\n    data() {\n        return {\n            title: 'uploadFile',\n            imageSrc: '',\n            task: null,\n            //自动化测试例专用\n            jest_result: false,\n        };\n    },\n    onLoad() {\n    },\n    onUnload() {\n        var _a;\n        this.imageSrc = '';\n        uni.hideLoading();\n        (_a = this.task) === null || _a === void 0 ? void 0 : _a.abort();\n    },\n    methods: {\n        chooseImage: function () {\n            uni.chooseImage({\n                count: 1,\n                sizeType: ['compressed'],\n                sourceType: ['album'],\n                success: (res) => {\n                    uni.__log__('log', 'at pages/API/upload-file/upload-file.uvue:50', 'chooseImage success, temp path is', res.tempFilePaths[0]);\n                    var imageSrc = res.tempFilePaths[0];\n                    uni.showLoading({\n                        title: '上传中'\n                    });\n                    this.task = uni.uploadFile({\n                        url: 'https://unidemo.dcloud.net.cn/upload',\n                        filePath: imageSrc,\n                        name: 'file',\n                        formData: new UTSJSONObject({\n                            'user': 'test'\n                        }),\n                        success: (res) => {\n                            uni.__log__('log', 'at pages/API/upload-file/upload-file.uvue:63', 'uploadImage success, res is:', res);\n                            uni.hideLoading();\n                            uni.showToast({\n                                title: '上传成功',\n                                icon: 'success',\n                                duration: 1000\n                            });\n                            this.imageSrc = imageSrc;\n                        },\n                        fail: (err) => {\n                            uni.__log__('log', 'at pages/API/upload-file/upload-file.uvue:73', 'uploadImage fail', err);\n                            uni.hideLoading();\n                            uni.showModal({\n                                content: err.errMsg,\n                                showCancel: false\n                            });\n                        },\n                    });\n                },\n                fail: (err) => {\n                    uni.__log__('log', 'at pages/API/upload-file/upload-file.uvue:83', 'chooseImage fail', err);\n                }\n            });\n        },\n        //自动化测试例专用\n        jest_uploadFile() {\n            const imageSrc = \"/static/uni.png\";\n            this.task = uni.uploadFile({\n                url: 'https://unidemo.dcloud.net.cn/upload',\n                filePath: imageSrc,\n                name: 'file',\n                formData: new UTSJSONObject({\n                    'user': 'test'\n                }),\n                success: () => {\n                    this.jest_result = true;\n                },\n                fail: () => {\n                    this.jest_result = false;\n                },\n            });\n        },\n        jest_uploadFile_with_uni_env() {\n            const filePath = `${uni.env.CACHE_PATH}/download/uni-app.png`;\n            uni.downloadFile({\n                url: \"https://qiniu-web-assets.dcloud.net.cn/unidoc/zh/uni-app.png\",\n                filePath: filePath,\n                success: () => {\n                    uni.uploadFile({\n                        url: 'https://unidemo.dcloud.net.cn/upload',\n                        filePath: filePath,\n                        name: 'file',\n                        success: () => {\n                            this.jest_result = true;\n                        },\n                        fail: () => {\n                            this.jest_result = false;\n                        },\n                    });\n                },\n                fail: () => {\n                    this.jest_result = false;\n                }\n            });\n        },\n        jest_set_cookie() {\n            uni.request({\n                url: \"https://request.dcloud.net.cn/api/http/header/setCookie\",\n                method: \"GET\",\n                timeout: 6000,\n                sslVerify: false,\n                withCredentials: false,\n                firstIpv4: false,\n                success: () => {\n                    this.jest_cookie_upload(true);\n                },\n                fail: () => {\n                    this.jest_result = false;\n                },\n            });\n        },\n        jest_delete_cookie() {\n            uni.request({\n                url: \"https://request.dcloud.net.cn/api/http/header/deleteCookie\",\n                method: \"GET\",\n                timeout: 6000,\n                sslVerify: false,\n                withCredentials: false,\n                firstIpv4: false,\n                success: () => {\n                    this.jest_cookie_upload(false);\n                },\n                fail: () => {\n                    this.jest_result = false;\n                },\n            });\n        },\n        jest_cookie_upload(needCookie) {\n            const imageSrc = \"/static/uni.png\";\n            this.task = uni.uploadFile({\n                url: 'https://request.dcloud.net.cn/api/http/header/upload',\n                filePath: imageSrc,\n                name: 'file',\n                success: (res) => {\n                    const data = UTS.JSON.parseObject(res.data);\n                    const errCode = data === null || data === void 0 ? void 0 : data.getNumber(\"errCode\");\n                    if (errCode != null && errCode == 1000) {\n                        this.jest_result = needCookie ? false : true;\n                    }\n                    else {\n                        this.jest_result = needCookie ? true : false;\n                    }\n                },\n                fail: () => {\n                    this.jest_result = false;\n                },\n            });\n        },\n        jest_files_upload() {\n            const imageSrc = \"/static/uni.png\";\n            this.task = uni.uploadFile({\n                url: 'https://unidemo.dcloud.net.cn/upload',\n                files: [\n                    {\n                        name: \"file1\",\n                        uri: imageSrc\n                    },\n                    {\n                        name: \"file2\",\n                        uri: imageSrc\n                    }\n                ],\n                success: (res) => {\n                    if (res.statusCode == 200) {\n                        this.jest_result = true;\n                    }\n                },\n                fail: () => {\n                    this.jest_result = false;\n                },\n            });\n        },\n        jest_uts_module_invoked() {\n            testInovkeUploadFile({\n                success: (res = null) => {\n                    uni.__log__('log', 'at pages/API/upload-file/upload-file.uvue:209', \"success :\", res);\n                    this.jest_result = true;\n                },\n                fail: (err = null) => {\n                    uni.__log__('log', 'at pages/API/upload-file/upload-file.uvue:213', \"fail :\", err);\n                    this.jest_result = false;\n                }\n            });\n        }\n    }\n});\n//# sourceMappingURL=/Users/gaoruicheng/Documents/DcloudProject/uniapp-bugs/uniapp-bugs-main/singlePage/uniapp-hello-x/pages/API/upload-file/upload-file.uvue?vue&type=script&lang.uts.js.map","references":[],"uniExtApis":["uni.hideLoading","uni.chooseImage","uni.__log__","uni.showLoading","uni.uploadFile","uni.showToast","uni.showModal","uni.downloadFile","uni.request"],"map":"{\"version\":3,\"file\":\"upload-file.uvue?vue&type=script&lang.uts.js\",\"sourceRoot\":\"\",\"sources\":[\"upload-file.uvue?vue&type=script&lang.uts\"],\"names\":[],\"mappings\":\"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\"}"}
