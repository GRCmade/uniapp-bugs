{"code":"import { defineComponent } from \"vue\";\nexport default defineComponent({\n    data() {\n        return {\n            connected: false,\n            connecting: false,\n            msg: '',\n            roomId: '',\n            platform: '',\n        };\n    },\n    computed: {\n        showMsg() {\n            if (this.connected) {\n                if (this.msg.length > 0) {\n                    return '收到消息：' + this.msg;\n                }\n                else {\n                    return '等待接收消息';\n                }\n            }\n            else {\n                return '尚未连接';\n            }\n        },\n    },\n    onLoad() {\n        this.platform = uni.getSystemInfoSync().platform;\n    },\n    onUnload() {\n        uni.closeSocket({\n            code: 1000,\n            reason: 'close reason from client',\n            success: (res = null) => {\n                uni.__log__('log', 'at pages/API/websocket-global/websocket-global.uvue:52', 'uni.closeSocket success', res);\n            },\n            fail: (err = null) => {\n                uni.__log__('log', 'at pages/API/websocket-global/websocket-global.uvue:55', 'uni.closeSocket fail', err);\n            },\n        });\n        uni.hideLoading();\n    },\n    methods: {\n        connect() {\n            if (this.connected || this.connecting) {\n                uni.showModal({\n                    content: '正在连接或者已经连接，请勿重复连接',\n                    showCancel: false,\n                });\n                return null;\n            }\n            this.connecting = true;\n            uni.showLoading({\n                title: '连接中...',\n            });\n            uni.connectSocket({\n                url: 'ws://websocket.dcloud.net.cn',\n                header: null,\n                protocols: null,\n                success: (res = null) => {\n                    // 这里是接口调用成功的回调，不是连接成功的回调，请注意\n                    uni.__log__('log', 'at pages/API/websocket-global/websocket-global.uvue:79', 'uni.connectSocket success', res);\n                },\n                fail: (err = null) => {\n                    // 这里是接口调用失败的回调，不是连接失败的回调，请注意\n                    uni.__log__('log', 'at pages/API/websocket-global/websocket-global.uvue:83', 'uni.connectSocket fail', err);\n                },\n            });\n            uni.onSocketOpen((res) => {\n                this.connecting = false;\n                this.connected = true;\n                uni.hideLoading();\n                uni.showToast({\n                    icon: 'none',\n                    title: '连接成功',\n                });\n                uni.__log__('log', 'at pages/API/websocket-global/websocket-global.uvue:95', 'onOpen', res);\n            });\n            uni.onSocketError((err) => {\n                this.connecting = false;\n                this.connected = false;\n                uni.hideLoading();\n                uni.showModal({\n                    content: '连接失败，可能是websocket服务不可用，请稍后再试',\n                    showCancel: false,\n                });\n                uni.__log__('log', 'at pages/API/websocket-global/websocket-global.uvue:106', 'onError', err);\n            });\n            uni.onSocketMessage((res) => {\n                this.msg = res.data;\n                uni.__log__('log', 'at pages/API/websocket-global/websocket-global.uvue:110', 'onMessage', res);\n            });\n            uni.onSocketClose((res) => {\n                this.connected = false;\n                this.msg = '';\n                uni.__log__('log', 'at pages/API/websocket-global/websocket-global.uvue:115', 'onClose', res);\n            });\n        },\n        send() {\n            uni.sendSocketMessage({\n                data: 'from ' +\n                    this.platform +\n                    ' : ' +\n                    parseInt((Math.random() * 10000).toString()).toString(),\n                success: (res = null) => {\n                    uni.__log__('log', 'at pages/API/websocket-global/websocket-global.uvue:126', res);\n                },\n                fail: (err = null) => {\n                    uni.__log__('log', 'at pages/API/websocket-global/websocket-global.uvue:129', err);\n                },\n            });\n        },\n        close() {\n            uni.closeSocket({\n                code: 1000,\n                reason: 'close reason from client',\n                success: (res = null) => {\n                    uni.__log__('log', 'at pages/API/websocket-global/websocket-global.uvue:138', 'uni.closeSocket success', res);\n                },\n                fail: (err = null) => {\n                    uni.__log__('log', 'at pages/API/websocket-global/websocket-global.uvue:141', 'uni.closeSocket fail', err);\n                },\n            });\n        },\n    },\n});\n//# sourceMappingURL=/Users/gaoruicheng/Documents/DcloudProject/uniapp-bugs/uniapp-bugs-main/singlePage/uniapp-hello-x/pages/API/websocket-global/websocket-global.uvue?vue&type=script&lang.uts.js.map","references":[],"uniExtApis":["uni.getSystemInfoSync","uni.closeSocket","uni.__log__","uni.hideLoading","uni.showModal","uni.showLoading","uni.connectSocket","uni.onSocketOpen","uni.showToast","uni.onSocketError","uni.onSocketMessage","uni.onSocketClose","uni.sendSocketMessage"],"map":"{\"version\":3,\"file\":\"websocket-global.uvue?vue&type=script&lang.uts.js\",\"sourceRoot\":\"\",\"sources\":[\"websocket-global.uvue?vue&type=script&lang.uts\"],\"names\":[],\"mappings\":\"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\"}"}
